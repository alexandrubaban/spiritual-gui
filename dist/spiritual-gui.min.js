/**
 * Spiritual GUI
 * (c) 2013 Wunderbyte
 * Spiritual is freely distributable under the MIT license.
 */
!function(t){"use strict";t.gui={portals:!0,MODE_NATIVE:"native",MODE_MANAGED:"managed",PARAM_CONTEXTID:"gui-contextid",PARAM_XHOST:"gui-xhost",BROADCAST_KICKSTART:"gui-broadcast-kickstart",BROADCAST_WILL_SPIRITUALIZE:"gui-broadcast-will-spiritualize",BROADCAST_DID_SPIRITUALIZE:"gui-broadcast-did-spiritualize",BROADCAST_MOUSECLICK:"gui-broadcast-mouseevent-click",BROADCAST_MOUSEMOVE:"gui-broadcast-mouseevent-mousemove",BROADCAST_MOUSEDOWN:"gui-broadcast-mouseevent-mousedown",BROADCAST_MOUSEUP:"gui-broadcast-mouseevent-mouseup",BROADCAST_SCROLL:"gui-broadcast-window-scroll",BROADCAST_RESIZE:"gui-broadcast-window-resize",BROADCAST_RESIZE_END:"gui-broadcast-window-resize-end",BROADCAST_POPSTATE:"gui-broadcast-window-popstate",BROADCAST_HASHCHANGE:"gui-broadcast-window-hashchange",BROADCAST_ORIENTATIONCHANGE:"gui-broadcast-orientationchange",BROADCAST_LOADING_CHANNELS:"gui-broadcast-loading-channels",BROADCAST_CHANNELS_LOADED:"gui-broadcast-channels-loaded",BROADCAST_TWEEN:"gui-broadcast-tween",BROADCAST_WILL_UNLOAD:"gui-broadcast-will-unload",BROADCAST_UNLOAD:"gui-broadcast-unload",BROADCAST_ATTENTION_ENTER:"gui-broadcast-attention-enter",BROADCAST_ATTENTION_EXIT:"gui-broadcast-attention-exit",BROADCAST_ATTENTION_MOVE:"gui-broadcast-attention-move",ACTION_DOC_ONDOMCONTENT:"gui-action-document-domcontent",ACTION_DOC_ONLOAD:"gui-action-document-onload",ACTION_DOC_ONHASH:"gui-action-document-onhash",ACTION_DOC_ONSPIRITUALIZED:"gui-action-document-spiritualized",ACTION_DOC_UNLOAD:"gui-action-document-unload",$ACTION_XFRAME_VISIBILITY:"gui-action-xframe-visibility",ACTION_WINDOW_LOADING:"gui-action-window-loading",ACTION_WINDOW_LOADED:"gui-action-window-loaded",LIFE_CONSTRUCT:"gui-life-construct",LIFE_CONFIGURE:"gui-life-configure",LIFE_ENTER:"gui-life-enter",LIFE_ATTACH:"gui-life-attach",LIFE_READY:"gui-life-ready",LIFE_DETACH:"gui-life-detach",LIFE_EXIT:"gui-life-exit",LIFE_ASYNC:"gui-life-async",LIFE_DESTRUCT:"life-destruct",LIFE_VISIBLE:"life-visible",LIFE_INVISIBLE:"life-invisible",LIFE_IFRAME_CONSTRUCT:"gui-life-iframe-construct",LIFE_IFRAME_DOMCONTENT:"gui-life-iframe-domcontent",LIFE_IFRAME_SPIRITUALIZED:"gui-life-iframe-spiritualized",LIFE_IFRAME_ONLOAD:"gui-life-iframe-onload",LIFE_IFRAME_ONHASH:"gui-life-iframe-onhash",LIFE_IFRAME_UNLOAD:"gui-life-iframe-unload",TICK_DOC_FIT:"gui-tick-document-fit",$TICK_INSIDE:"gui-tick-spirits-inside",$TICK_OUTSIDE:"gui-tick-spirits-outside",$TICK_DESTRUCT:"gui-tick-spirits-destruct",CRAWLER_SPIRITUALIZE:"gui-crawler-spiritualize",CRAWLER_MATERIALIZE:"gui-crawler-materialize",CRAWLER_DETACH:"gui-crawler-detach",CRAWLER_DISPOSE:"gui-crawler-dispose",CRAWLER_ACTION:"gui-crawler-action",CRAWLER_VISIBLE:"gui-crawler-visible",CRAWLER_INVISIBLE:"gui-crawler-invisible",CRAWLER_DOMPATCHER:"gui-crawler-webkit-dompatcher",CLASS_INVISIBLE:"_gui-invisible",CLASS_HIDDEN:"_gui-hidden",CLASS_COVER:"_gui-cover",TIMEOUT_RESIZE_END:250,orientation:0,ORIENTATION_PORTRAIT:0,ORIENTATION_LANDSCAPE:1},gui.URL=function(t,i){if(!t||t.nodeType!==Node.DOCUMENT_NODE)throw new TypeError("Document expected");var e,n=gui.URL._createLink(t,i);Object.keys(gui.URL.prototype).forEach(function(t){gui.Type.isString(e=n[t])&&("pathname"!==t||e.startsWith("/")||(e="/"+e),this[t]=e)},this),this.id=this.hash?this.hash.substring(1):null,this.external=this.href.split("#")[0]!==t.URL.split("#")[0]},gui.URL.prototype={hash:null,host:null,hostname:null,href:null,pathname:null,port:null,protocol:null,search:null,id:null,external:!1,toString:function(){return this.href}},gui.URL.absolute=function(t,i){if(i=i||"",t.nodeType===Node.DOCUMENT_NODE)return new gui.URL(t,i).href;if("string"==typeof t){var e=t.split("/"),n=i.split("/");return e.pop(),n.forEach(function(t){"."!==t&&(".."===t?e.pop():e.push(t))}),e.join("/")}},gui.URL.external=function(t,i){i=i||document;var e=new gui.URL(i,t);return e.host!==i.location.host||e.port!==i.location.port},gui.URL.getParam=function(t,i){i=i.replace(/(\[|\])/g,"\\$1");var e=new RegExp("[\\?&]"+i+"=([^&#]*)").exec(t);return null===e?null:e[1]},gui.URL.setParam=function(t,i,e){var n,r=[],s=-1,o=t.split("#")[0],u=t.split("#")[1];return o.indexOf("?")>-1&&(n=o.split("?"),o=n[0],r=n[1].split("&"),r.every(function(t,n){var o=t.split("=");return o[0]===i&&(s=n,null!==e&&(o[1]=e,r[n]=o.join("="))),0>s})),null===e?s>-1&&r.remove(s,s):0>s&&(r[r.length]=[i,e].join("=")),r=r.length>0?"?"+r.join("&"):"",o+r+(u?"#"+u:"")},gui.URL.parametrize=function(t,i){return gui.Type.isObject(i)&&gui.Object.each(i,function(i,e){switch(t+=t.contains("?")?"&":"?",gui.Type.of(e)){case"array":t+=e.map(function(t){return i+"="+String(t)}).join("&");break;default:t+=i+"="+String(e)}}),t},gui.URL.origin=function(t){var i=t.location;return i.origin||i.protocol+"//"+i.host},gui.URL._createLink=function(t,i){var e=t.createElement("a");if(e.href=i||"",gui.Client.isExplorer){var n=gui.URL.parseUri(e.href);Object.keys(n).forEach(function(t){e[t]||(e[t]=n[t])})}return e},gui.URL.parseUri=function(t){for(var i=gui.URL.parseOptions,e=i.parser[i.strictMode?"strict":"loose"].exec(t),n={},r=14;r--;)n[i.key[r]]=e[r]||"";return n[i.q.name]={},n[i.key[12]].replace(i.q.parser,function(t,e,r){e&&(n[i.q.name][e]=r)}),n},gui.URL.parseOptions={strictMode:!0,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},gui.KeyMaster={generateKey:function(t){t="key";var i=Math.random().toString(),e=(t||"key")+i.slice(2,11);return this._keys[e]?e=this.generateKey(t):this._keys[e]=!0,e},generateGUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=16*Math.random()|0,e="x"===t?i:3&i|8;return e.toString(16)}).toUpperCase()},isKey:function(t){var i=null,e=!1;return gui.Type.isString(t)&&(i=this.extractKey(t),e=i&&i[0]===t),e},extractKey:function(t){return/key\d{9}/.exec(t)},_keys:Object.create(null)},gui.SpiritualAid={polyfill:function(t,i){this._strings(t),this._arrays(t),this._functions(t),this._globals(t),this._extras(t),i||this._effects(t)},_extend:function(t,i){Object.keys(i).forEach(function(e){var n=i[e];void 0===t[e]&&(n.get&&n.set||(t[e]=n))})},_strings:function(t){this._extend(t.String.prototype,{trim:function(){return this.replace(/^\s*/,"").replace(/\s*$/,"")},repeat:function(i){return new t.Array(i+1).join(this)},startsWith:function(t){return 0===this.indexOf(t)},endsWith:function(t){t=String(t);var i=this.lastIndexOf(t);return i>=0&&i===this.length-t.length},contains:function(t){return this.indexOf(t)>-1},toArray:function(){return this.split("")}})},_arrays:function(t){this._extend(t.Array,{every:function(t,i,e){for(var n=!0,r=t.length>>>0,s=0;r>s;s++)if(void 0!==t[s]&&!i.call(e,t[s],s,t)){n=!1;break}return n},forEach:function(t,i,e){for(var n=t.length>>>0,r=0;n>r;r++)void 0!==t[r]&&i.call(e,t[r],r,t)},map:function(t,i,e){for(var n=[],r=t.length>>>0,s=0;r>s;s++)void 0!==t[s]&&n.push(i.call(e,t[s],s,t));return n},filter:function(t,i,e){return Array.prototype.filter.call(t,i,e)},isArray:function(i){return"[object Array]"===t.Object.prototype.toString.call(i)},concat:function(t,i){function e(t){return t}return this.map(t,e).concat(this.map(i,e))}})},_functions:function(t){this._extend(t.Function.prototype,{bind:function(i){if("function"!=typeof this)throw new t.TypeError("Function bind not callable");var e=t.Array.prototype.slice,n=e.call(arguments,1),r=this,s=function(){},o=function(){return r.apply(this instanceof s?this:i||t,n.concat(e.call(arguments)))};return s.prototype=this.prototype,o.prototype=new s,o}})},_globals:function(t){this._extend(t,{console:{log:function(){},debug:function(){},warn:function(){},error:function(){}},Map:function(){function t(){this._map=Object.create(null)}return t.prototype={isNative:!1,get:function(t){return this._map[t]},set:function(t,i){this._map[t]=i},has:function(t){return void 0!==this._map[t]},"delete":function(t){delete this._map[t]},size:function(){return Object.keys(this._map).length}},t}(),Set:function(){function t(){this._map=Object.create(null)}return t.prototype={isNative:!1,add:function(t){this._map[t]=!0},has:function(t){return this._map[t]===!0},"delete":function(t){delete this._map[t]},size:function(){return Object.keys(this._map).length}},t}(),WeakMap:function(){function i(){function t(t){return e(t)&&(a.splice(n,1),c.splice(n,1)),n>-1}function i(t,i){return e(t)?c[n]:i}function e(t){return n=u.call(a,t),n>-1}function r(t,i){e(t)?c[n]=i:c[a.push(t)-1]=i}var a=[],c=[];return o(s,{isNative:{value:!1},"delete":{value:t},del:{value:t},get:{value:i},has:{value:e},set:{value:r}})}function e(){}var n,r=t.Object,s=i.prototype,o=r.create,u=[].indexOf;return i.prototype=e.prototype=s=new i,i}()})},_effects:function(i){this._extend(i,{requestAnimationFrame:function(){var e=i.requestAnimationFrame||i.webkitRequestAnimationFrame||i.mozRequestAnimationFrame||i.oRequestAnimationFrame||i.msRequestAnimationFrame||function(){var i=0;return function(e){var n=(new Date).getTime(),r=Math.max(0,16-(n-i)),s=t.setTimeout(function(){e(n+r)},r);return i=n+r,s}}();return e}(),setImmediate:function(){var t=[],e=1,n="spiritual:emulated:setimmediate";return i.addEventListener("message",function(e){e.data===n&&t.length&&(t.shift().apply(i),e.stopPropagation())},!1),function(r){return t.push(r),i.postMessage(n,"*"),e++}}()})},_extras:function(t){this._extend(t.Map.prototype,{del:function(t){return this["delete"](t)}}),this._extend(t.Set.prototype,{del:function(t){return this["delete"](t)}}),this._extend(t.console,{debug:t.console.log}),this._extend(XMLHttpRequest.prototype,{overrideMimeType:function(){}}),this._extend(t.XMLHttpRequest,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4})}},gui.Spiritual=function(t){this._construct(t)},gui.Spiritual.prototype={constructor:gui.Spiritual,$contextid:null,context:null,window:null,document:null,mode:"native",autostart:!0,hosted:!1,portalled:!1,xhost:null,spiritualized:!1,attributes:["gui"],toString:function(){return"[namespace gui]"},start:function(){return this._gone=!0,this._then=new gui.Then,this._experimental(),null!==this._configs&&this._configs.forEach(function(t){this.channel(t.select,t.klass)},this),this._pingpong||(this._spinatkrampe(),this._then.now()),this._then},kickstart:function(){switch(document.readyState){case"interactive":case"complete":gui.Broadcast.dispatchGlobal(null,gui.BROADCAST_KICKSTART)}},get:function(t){var i,e,n=this.document;switch(gui.Type.of(t)){case"string":gui.KeyMaster.isKey(t)&&(i=this._spirits.inside[t]),i||(e=n.getElementById(t)||n.querySelector(t),i=e?e.spirit:null);break;case"function":var r,s=this._spirits.inside;gui.Type.isSpiritConstructor(t)&&Object.keys(this._spirits.inside).some(function(e){return(r=s[e]).constructor===t?(i=r,!0):void 0});break;case"undefined":throw new TypeError}return i||null},ready:function(t,i){var e=this.spiritualized;return arguments.length&&(e?t.call(i):(this._onreadys=this._onreadys||[],this._onreadys.push(function(){t.call(i)}))),e},getAll:function(){console.error("TODO: gui.getAll")},module:function(t,i){if(!gui.Type.isString(t))throw new Error("Module requires a name");return i=this._modules[t]=new(gui.Module.extend(t,i))(this.context)},hasModule:function(t){return gui.Type.isDefined(this._modules[t])},channel:function(t,i){var e=null;if(this._gone){if(e="string"==typeof i?gui.Object.lookup(i,this.context):i,!gui.Type.isFunction(e))throw"Unknown Spirit for selector: "+t;this._channels.push([t,e])}else this._configs||(this._configs=[]),this._configs.push({select:t,klass:i})},channelModule:function(t){var i;t=t.map(function(t){var e=t[0],n=t[1];return i="string"==typeof n?gui.Object.lookup(n,this.context):n,[e,i]},this),this._channels=t.concat(this._channels)},portal:function(t){if(t!==this.context){var i=t.gui=new this.constructor(t),e=[];i.portalled=!0,i.mode=this.mode,i._spaces=this._spaces.filter(function(t){var i=gui.Object.lookup(t,this.context);return i.portals},this),this._spaces.forEach(function(i){var n=this.window[i];if(n.portals){var r=t,s=this.context;i.split(".").forEach(function(t){gui.Type.isDefined(r[t])||(r[t]=s[t]),r=r[t],s=s[t]}),this._index(s,r,this._channels).forEach(function(t){e.push(t)})}},this),gui.Object.each(this._modules,function(t,e){e.$setupcontext(i.context),i._modules[t]=e},this),e.sort(function(t,i){return t-i}).forEach(function(t){i._channels.push(this._channels[t])},this),gui.Guide.observe(t)}},namespace:function(t,i,e){e=e||self;var n,r=e.gui._spaces;if(!gui.Type.isString(t))throw new TypeError("Expected a namespace string");return n=gui.Object.lookup(t,e),n||(n=new gui.Namespace(t,e),n=gui.Object.assert(t,n,e),r.push(t)),gui.Object.extend(n,i||{})},namespaces:function(){return this._spaces.slice()},evaluate:function(t){var i=null;if(t.nodeType===Node.ELEMENT_NODE){var e=t.ownerDocument,n=e.defaultView;n.gui.attributes.every(function(e){return i=this._evaluateinline(t,n,e),null===i},this)&&n.gui._channels.every(function(e){var n=e[0],r=e[1];return gui.CSSPlugin.matches(t,n)&&(i=r),null===i},this)}return i},broadcastGlobal:function(t,i){gui.Type.isEvent(i)&&(i=new gui.EventSummary(i)),gui.Broadcast.dispatchGlobal(this,t,i)},debugchannels:function(){var t=this.document.location.toString();this._channels.forEach(function(i){t+="\n"+i[0]+" : "+i[1]}),console.log(t+"\n\n")},destruct:function(t){var i=this._spirits,e=t.$instanceid;delete i.inside[e],delete i.outside[e],this._jensen(t)},inside:function(t){var i=this._spirits,e=t.$instanceid;i.inside[e]||(i.outside[e]&&delete i.outside[e],i.inside[e]=t,i.incoming.push(t),gui.Tick.dispatch(gui.$TICK_INSIDE,4,this.$contextid))},outside:function(t){var i=this._spirits,e=t.$instanceid;i.outside[e]||(i.inside[e]&&(delete i.inside[e],this._jensen(t)),i.outside[e]=t,gui.Tick.dispatch(gui.$TICK_OUTSIDE,0,this.$contextid))},_jensen:function(t){var i=this._spirits.incoming;if(i.length){var e=i.indexOf(t);e>-1&&gui.Array.remove(i,e)}},ontick:function(t){var i;switch(t.type){case gui.$TICK_INSIDE:gui.Guide.$goasync(this._spirits.incoming),this._spirits.incoming=[];break;case gui.$TICK_OUTSIDE:i=gui.Object.each(this._spirits.outside,function(t,i){return i}),i.forEach(function(t){gui.Spirit.$destruct(t)}),i.forEach(function(t){gui.Spirit.$dispose(t)}),this._spirits.outside=Object.create(null)}},nameDestructAlreadyUsed:function(){gui.Tick.remove(gui.$TICK_OUTSIDE,this,this.$contextid),this.window.removeEventListener("message",this),["_spiritualaid","context","document","_channels","_inlines","_spaces","_modules","_spirits"].forEach(function(t){this[t]=null},this)},_channels:null,_inlines:null,_spaces:null,_gone:!1,_configs:null,_modules:null,_spirits:null,_spiritualaid:gui.SpiritualAid,_construct:function(t){this._spiritualaid.polyfill(t),this.context=t,this.window=t.document?t:null,this.document=t.document||null,this.hosted=this.window&&this.window!==this.window.parent,this.$contextid=gui.KeyMaster.generateKey(),this._inlines=Object.create(null),this._modules=Object.create(null),this._arrivals=Object.create(null),this._channels=[],this._spaces=["gui"],this._spirits={incoming:[],inside:Object.create(null),outside:Object.create(null)},this.hosted&&(this.xhost="*")},handleEvent:function(t){if("message"===t.type){var i=this.window.parent;t.source===i&&this._gotponged(t.data)&&this.window.removeEventListener("message",this)}},_gotponged:function(t){var i="spiritual-pong:",e=this.window.location,n=e.origin||e.protocol+"//"+e.host;if("string"==typeof t&&t.startsWith(i)){var r=t.slice(i.length);return r!==n&&(this.xhost=r),this._spinatkrampe(),this._pingpong=!1,this._then&&this._then.now(),!0}return!1},_evaluateinline:function(t,i,e){var n=null,r=t.getAttribute(e);return gui.Type.isString(r)&&!r.startsWith("[")&&(""!==r?(n=i.gui._inlines[r],gui.Type.isDefined(n)||(n=gui.Object.lookup(r,i)),n?i.gui._inlines[r]=n:console.error(r+" is not defined.")):n=!1),n},_index:function(t,i,e){function n(n){switch(n){case"$contextid":case"context":break;default:var s=i[n]=t[n];gui.Type.isSpiritConstructor(s)&&s.portals&&e.forEach(function(t,i){t[1]===s&&r.push(i)})}}var r=[];for(var s in t)this.constructor.prototype.hasOwnProperty(s)||s.startsWith("_")||n(s);return r},$onready:function(){this.spiritualized=!0;var t=this._onreadys;if(t){for(;t.length;)t.shift()();this._onreadys=null}},_experimental:function(){this.$ns="gui",gui.Object.extendmissing(this,gui.Namespace.prototype),this._spaces.forEach(function(t){gui.Object.lookup(t,this.window).spacename()},this)},_spinatkrampe:function(){gui.Tick.add([gui.$TICK_INSIDE,gui.$TICK_OUTSIDE],this,this.$contextid)}},Object.keys(gui).forEach(function(t){gui.Spiritual.prototype[t]=gui[t]}),gui=new gui.Spiritual(t),gui.Object={create:function(t,i){var e={};return Object.keys(i).forEach(function(t){e[t]={value:i[t],writable:!0,enumerable:!0,configurable:!0}}),Object.create(t,e)},extend:function(t,i,e){var n=this._hiding;if(!gui.Type.isObject(i))throw new TypeError("Expected  object, got "+gui.Type.of(i));return Object.keys(i).forEach(function(r){if(!e||!gui.Type.isDefined(t[r])){var s=Object.getOwnPropertyDescriptor(i,r);s=n?gui.Object._hide(s):s,Object.defineProperty(t,r,s)}},this),t},extendmissing:function(t,i){return this.extend(t,i,!0)},copy:function(t){return this.extend({},t)},each:function(t,i,e){return Object.keys(t).map(function(n){return i.call(e,n,t[n])}).filter(function(t){return void 0!==t})},all:function(t,i,e){var n=[];for(var r in t)n.push(i.call(e,r,t[r]));return n},map:function(t,i,e){var n,r={};return this.each(t,function(t,s){n=i.call(e,t,s),void 0!==n&&(r[t]=n)}),r},lookup:function(t,i){var e,n=i||self;if(!gui.Type.isString(t))throw new TypeError("Expected string, got "+gui.Type.of(t));if(t.contains(".")){var r=t.split(".");r.every(function(t){return n=n[t],gui.Type.isDefined(n)}),e=n}else e=n[t];return e},assert:function(t,i,e){var n,r=e||self;if(t.contains(".")){var s=t.split(".");n=s.pop(),s.forEach(function(t){r=r[t]||(r[t]={})})}else n=t;return r&&(r[n]=i),i},methods:function(t){var i=[];for(var e in t)gui.Type.isMethod(t[e])&&i.push(e);return i},ownmethods:function(t){return Object.keys(t).filter(function(i){return gui.Type.isMethod(t[i])}).map(function(t){return t})},nonmethods:function(t){var i=[];for(var e in t)gui.Type.isFunction(t[e])||i.push(e);return i},bindall:function(t){return gui.Object.ownmethods(t).filter(function(t){return"_"!==t[0]}).forEach(function(i){t[i]=t[i].bind(t)}),t},hidden:function(t){return gui.Object._hiding=!0,t.$hidden=!0,t},_hiding:!1,_hide:function(t){return t.value&&gui.Type.isFunction(t.value)&&t.value.$hidden&&t.configurable&&(t.enumerable=!1),t}},gui.Type={of:function(t){var i={}.toString.call(t).match(this._typeexp)[1].toLowerCase();return"domwindow"===i&&"undefined"===String(typeof t)&&(i="undefined"),i},isDefined:function(t){return"undefined"!==this.of(t)},isComplex:function(t){switch(this.of(t)){case"undefined":case"boolean":case"number":case"string":case"null":return!1}return!0},isWindow:function(t){return t&&t.document&&t.location&&t.alert&&t.setInterval},isEvent:function(t){return this.of(t).endsWith("event")&&this.isDefined(t.type)},isMethod:function(t){return this.isFunction(t)&&!this.isConstructor(t)},isSpirit:function(t){return t&&t instanceof gui.Spirit},isConstructor:function(t){return this.isFunction(t)&&this.isObject(t.prototype)&&Object.keys(t.prototype).length},isSpiritConstructor:function(t){return this.isFunction(t)&&this.isBoolean(t.portals)},cast:function(t){var i=String(t);switch(i){case"null":i=null;break;case"true":case"false":i="true"===i;break;default:String(parseInt(i,10))===i?i=parseInt(i,10):String(parseFloat(i))===i&&(i=parseFloat(i))}return i},_typeexp:/\s([a-zA-Z]+)/},function(){["array","function","object","string","number","boolean","null","arguments","file"].forEach(function(t){this["is"+t[0].toUpperCase()+t.slice(1)]=function(i){return this.of(i)===t}},this)}.call(gui.Type),gui.Object.bindall(gui.Type),gui.Array={of:function(){return Array.of||function(){return Array.prototype.slice.call(arguments)}}(),from:function(){return Array.from||function(t){for(var i=[],e=Object(t),n=e.length>>>0,r=0;n>r;)r in e&&(i[r]=e[r]),r++;return i}}(),make:function(t){switch(gui.Type.of(t)){case"string":return t.split(" ");case"array":return this.from(t);default:return this.of(t)}},remove:function(t,i,e){return isNaN(i)?this.remove(t,t.indexOf(i),t.indexOf(e)):(t.splice(i,!e||1+e-i+(!(0>e^i>=0)&&(0>e||-1)*t.length)),t.length)}},gui.Arguments={provided:function(){var t=gui.Array.from(arguments);return function(i){return function(){return gui.Arguments._match(arguments,t)?i.apply(this,arguments):void 0}}},confirmed:function(){var t=gui.Array.from(arguments);return function(i){return function(){return gui.Arguments._validate(arguments,t)?i.apply(this,arguments):(gui.Arguments._abort(this),void 0)}}},_validating:!1,_bugsummary:null,_match:function(t,i){return i.every(function(i,e){return this._matches(i,t[e],e)},this)},_validate:function(t,i){this._validating=!0;var e=this._match(t,i);return this._validating=!1,e},_xtract:function(t,i){return i?t.slice(1,-1):t},_matches:function(t,i,e){var n=!t.startsWith("("),r=this._xtract(t,!n).split("|"),s=gui.Type.of(i),o="*"===t||!n&&"undefined"===s||!n&&r.indexOf("*")>-1||r.indexOf(s)>-1;return!o&&this._validating&&(this._bugsummary=[e,t,s]),o},_abort:function(t){var i=this._bugsummary,e=t.constructor.$classname||String(t);throw new TypeError(["Bad argument "+i.shift(),"for "+e+":","Expected "+i.shift()+",","got "+i.shift()].join(" "))}},gui.Function={create:function(t,i,e,n){var r=n?n.Function:Function;return t=this.safename(t),i=i?i.join(","):"",e=e||"",new r("return function "+t+" ( "+i+" ) {"+e+"}")()},decorateBefore:gui.Arguments.confirmed("object|function","string","function")(function(t,i,e){return this._decorate("before",t,i,e)}),decorateAfter:gui.Arguments.confirmed("object|function","string","function")(function(t,i,e){return this._decorate("after",t,i,e)}),decorateAround:function(){throw new Error("TODO")},safename:function(t){return t&&t.contains(".")&&(t=t.split(".").pop()),t||""},_decorate:function(t,i,e,n){return i[e]=gui.Combo[t](n)(i[e]),i},_decorated:function(t,i,e){var n=!0,r=e.toString(),s=t.$decorators||function(){return t.$decorators=Object.create(null),t.$decorators}();return(n=s[i]!==r)&&(s[i]=r),n}},gui.Namespace=function(t,i){this.$context=i,this.$ns=t},gui.Namespace.prototype={portals:!1,toString:function(){return"[namespace "+this.$ns+"]"},spacename:function(){return this._spacename(this,this.$ns),this},_spacename:function(t,i){gui.Object.each(t,function(t,e){"$superclass"!==t&&gui.Type.isConstructor(e)&&e.$classname===gui.Class.ANONYMOUS&&(e.$classname=i+"."+t,this._spacename(e,i+"."+t))},this)},$ns:null,$context:null},gui.Namespace.validate=function(t,i,e){gui.Tick.next(function(){if(gui.Object.lookup(i,t)!==e)throw new ReferenceError('The string "'+i+'" must evaluate to a namespace object.')},this)},gui.Class={create:function(){var t=this._breakdown_base(arguments),i=this._createclass(null,t.proto,t.name);return gui.Object.extend(i.prototype,t.protos),gui.Object.extend(i,t.statics),t.recurring&&gui.Object.each(t.recurring,function(t,e){var n=Object.getOwnPropertyDescriptor(i,t);(!n||n.writable)&&(i[t]=i.$recurring[t]=e)}),i},breakdown:function(t){return this._breakdown_subs(t)},$constructor:function(){var i=this.$onconstruct||this.onconstruct,e=gui.Property.nonenumerable,n=this;return t.Object.defineProperties(this,{$instanceid:e({value:gui.KeyMaster.generateKey()}),displayName:e({value:this.constructor.displayName,writable:!0})}),gui.Type.isFunction(i)&&(n=i.apply(this,arguments)),n||this},_classes:Object.create(null),ANONYMOUS:"Anonymous",_BODY:function(t){var i=t.toString().trim();return i.slice(i.indexOf("{")+1,-1)}(function i(){return this instanceof i?gui.Class.$constructor.apply(this,arguments):i.extend.apply(i,arguments)}),_breakdown_base:function(t){var i=gui.Type.isString(t[0]);return{name:i?t[0]:null,proto:t[i?1:0]||Object.create(null),protos:t[i?2:1]||Object.create(null),recurring:t[i?3:2]||Object.create(null),statics:t[i?4:3]||Object.create(null)}},_breakdown_subs:function(t){var i=gui.Type.isString(t[0]);return{name:i?t[0]:null,protos:t[i?1:0]||Object.create(null),recurring:t[i?2:1]||Object.create(null),statics:t[i?3:2]||Object.create(null)}},_createclass:function(t,i,e){e=e||gui.Class.ANONYMOUS;var n=gui.Function.create(e,null,this._namedbody(e));return n.$classid=gui.KeyMaster.generateKey("class"),n.prototype=Object.create(i||null),n.prototype.constructor=n,n=this._internals(n,t),n=this._interface(n),n=this._classname(n,e),gui.Property.accessor(n.prototype,"$classname",{getter:function(){return this.constructor.$classname}}),n},_createsubclass:function(t,i){return i=this.breakdown(i),gui.Type.isDefined(i.config)&&console.warn("'config' has been renamed 'attconfig'"),t.$super=t.$super||new gui.Super(t),this._extend_fister(t,i.protos,i.recurring,i.statics,i.name)},_extend_fister:function(t,i,e,n,r){var s=this._createclass(t,t.prototype,r);return gui.Object.extend(s,n),gui.Object.extend(s.$recurring,e),gui.Object.each(s.$recurring,function(t,i){var e=Object.getOwnPropertyDescriptor(s,t);(!e||e.writable)&&(s[t]=i)}),gui.Property.extendall(i,s.prototype),gui.Super.support(t,s,i),s=this._classname(s,r)},_internals:function(t,i){return t.$super=null,t.$subclasses=[],t.$superclass=i||null,t.$recurring=i?gui.Object.copy(i.$recurring):Object.create(null),i&&i.$subclasses.push(t),t},_interface:function(t){return["extend","mixin","is"].forEach(function(i){t[i]=this[i]},this),t},_classname:function(t,i){return t.$classname=i||gui.Class.ANONYMOUS,t.toString=function(){return"[function "+this.$classname+"]"},t.prototype.toString=function(){return"[object "+this.constructor.$classname+"]"},t},_namedbody:function(t){return this._BODY.replace(new RegExp("\\$name","gm"),gui.Function.safename(t))}},gui.Object.extend(gui.Class,{extend:function(){return gui.Class._createsubclass(this,arguments)},mixin:function(){return Array.forEach(arguments,function(t,i){t&&(0===i?gui.Object.each(t,function(t,i){this.prototype[t]=i,gui.Class.descendantsAndSelf(this,function(i){i.$super&&gui.Super.generateStub(i.$super,i.prototype,t)})},this):gui.Object.each(t,function(t,e){this[t]=e,1===i&&(this.$recurring[t]=e)},this))},this),this},is:function(t){return gui.Type.isObject(t)&&t instanceof this},isInstance:function(){console.error("Deprecated API is derecated")}}),gui.Object.extend(gui.Class,{children:function(t,i,e){var n=[];return i=i||gui.Combo.identity,t.$subclasses.forEach(function(t){n.push(i.call(e,t))},e),n},descendants:function(t,i,e,n){return n=n||[],i=i||gui.Combo.identity,t.$subclasses.forEach(function(t){n.push(i.call(e,t)),gui.Class.descendants(t,i,e,n)},e),n},descendantsAndSelf:function(t,i,e){var n=[];return i=i||gui.Combo.identity,n.push(i.call(e,t)),this.descendants(t,i,e,n)},parent:function(t,i,e){return i=i||gui.Combo.identity,i.call(e,t.$superclass)},ancestors:function(t,i,e,n){return n=n||[],i=i||gui.Combo.identity,t.$superclass&&(n.push(i.call(e,t.$superclass)),gui.Class.ancestors(t.$superclass,i,e,n)),n},ancestorsAndSelf:function(t,i,e){var n=[];return i=i||gui.Combo.identity,n.push(i.call(e,t)),this.ancestors(t,i,e,n)}}),gui.Property={extendall:function(t,i){return Object.keys(t).forEach(function(e){this.extend(t,i,e)},this),i},extend:function(t,i,e){var n=Object.getOwnPropertyDescriptor(t,e);return n=this._accessor(i,e,n),Object.defineProperty(i,e,n),i},nonenumerable:function(t){return gui.Object.extendmissing({configurable:!0,enumerable:!1},t)},accessor:function(t,i,e){if(this._isaccessor(e))return Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:e.getter||this._NOGETTER,set:e.setter||this._NOSETTER});throw new TypeError("Expected getter and/or setter method")},_isaccessor:function(t){return Object.keys(t).every(function(i){var e=!1;switch(i){case"getter":case"setter":e=gui.Type.isFunction(t[i])}return e})},_accessor:function(t,i,e){var n=e.value;return gui.Type.isObject(n)&&(n.getter||n.setter)&&this._isactive(n)&&(e=this._activeaccessor(t,i,n)),e},_isactive:function(t){return Object.keys(t).every(function(i){var e=!1;switch(i){case"getter":case"setter":e=gui.Type.isFunction(t[i])}return e})},_activeaccessor:function(t,i,e){var n;return["getter","setter"].forEach(function(r,s){for(;t&&!gui.Type.isDefined(e[r]);)t=Object.getPrototypeOf(t),n=Object.getOwnPropertyDescriptor(t,i),n&&(e[r]=n[s?"set":"get"])}),{enumerable:!0,configurable:!0,get:e.getter||this._NOGETTER,set:e.setter||this._NOSETTER}},_NOGETTER:function(){throw new Error("Getting a property that has only a setter")},_NOSETTER:function(){throw new Error("Setting a property that has only a getter")}},gui.Object.bindall(gui.Property),gui.Interface={validate:function(t,i){var e=!0,n=t.toString(),r=gui.Type.of(i);switch(r){case"null":case"string":case"number":case"boolean":case"undefined":throw new Error("Expected "+n+", got "+r+": "+i);default:try{var s=null,o=null;if(e=Object.keys(t).every(function(e){return s=e,o=gui.Type.of(t[e]),gui.Type.of(i[e])===o}),!e)throw new Error("Expected "+n+". A required "+r+' "'+s+'" is missing')}catch(u){throw new Error("Expected "+n)}}return e}},gui.Combo={before:function(t){return function(i){return function(){return t.apply(this,arguments),i.apply(this,arguments)}}},after:function(t){return function(i){return function(){var e=i.apply(this,arguments);return t.apply(this,arguments),e}}},around:function(t){return function(i){return function(){var e,n,r,s=this,o=gui.Combo._slice;return e=1<=arguments.length?o.call(arguments,0):[],r=void 0,n=function(){return r=i.apply(s,e)},t.apply(this,[n].concat(e)),r}}},provided:function(t){return function(i,e){return function(){return t.apply(this,arguments)?i.apply(this,arguments):e?e.apply(this,arguments):void 0}}},chained:function(t){return function(){var i=t.apply(this,arguments);return void 0===i?this:i}},identity:function(t){return t},_slice:[].slice},gui.Super=function(t){gui.Super.generateStubs(this,t.prototype)},gui.Super.prototype=Object.create(null),gui.Object.extend(gui.Super,{$subject:null,toString:function(){return"[function gui.Super]"},generateStubs:function(t,i){gui.Object.methods(i).forEach(function(e){gui.Super.generateStub(t,i,e)},this)},generateStub:function(t,i,e){var n=t[e]=function(){return i[e].apply(gui.Super.$subject,arguments)};n.displayName=e},support:function(t,i,e){var n=i.prototype,r=this._decorator(t);gui.Object.each(e,function(t,i){gui.Type.isMethod(i)&&(n[t]=r(i),gui.debug&&(n[t].toString=function(){var t=i.toString().replace(/\t/g,"  ");return gui.Super._DISCLAIMER+t}))},this)},_DISCLAIMER:"/**\n  * Method was mutated by the framework. \n  * This is an approximation of the code. \n  */\n",_ERROR:"Lost the track in 'this._super'. Super doesn't work well in asynchronous code, are we using a timeout? Perhaps move the 'this._super' call to another method or use 'othermethod.apply(this)'",_decorator:function(t){return function(i){return function(){return gui.Super._supercall(this,i,arguments,t)}}},_supercall:function(t,i,e,n){var r,s=gui.Super.$subject;if(!t)throw new ReferenceError(gui.Super._ERROR);return gui.Super.$subject=t,t._super=n.$super,r=i.apply(t,e),gui.Super.$subject=s,r}}),gui.Position=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0},gui.Position.prototype={x:0,y:0,z:0,toString:function(){return"[object gui.Position]"},clone:function(){return new gui.Position(this.x,this.y,this.z)}},gui.Position.isEqual=function(t,i){return t.x===i.x&&t.y===i.y},gui.Dimension=function(t,i){this.w=t||0,this.h=i||0},gui.Dimension.prototype={w:0,h:0,toString:function(){return"[object gui.Dimension]"
}},gui.Dimension.isEqual=function(t,i){return t.w===i.w&&t.h===i.h},gui.Geometry=function(t,i,e,n){this.x=t||0,this.y=i||0,this.w=e||0,this.h=n||0},gui.Geometry.prototype={x:0,y:0,w:0,h:0,toString:function(){return"[object gui.Geometry]"},hitTest:function(t){return gui.Geometry.hitTest(this,t)}},gui.Geometry.isEqual=function(t,i){return t.x===i.x&&t.y===i.y&&t.w===i.w&&t.h===i.h},gui.Geometry.hitTest=function(t,i){function e(t,i){return t.x>=i.x&&t.x<=i.x+i.w}function n(t,i){return t.y>=i.y&&t.y<=i.y+i.h}var r=e(t,i)||e(i,t),s=n(t,i)||n(i,t);return r&&s},gui.Then=function(t,i){t&&this.then(t,i)},gui.Then.prototype={toString:function(){return"[object gui.Then]"},then:function(t,i){this._callback=t?t:null,this._pointer=i?i:null,this._now&&this.now()},now:function(){var t=this._callback,i=this._pointer;t?(this.then(null,null),t.apply(i,arguments)):this._now=!0},_callback:null,_pointer:null,_now:!1},gui.HTMLParser={toString:function(){return"[object gui.HTMLParser]"},parse:function(t,i){return this.parseAll(t,i)[0]||null},parseAll:function(t,i){return this.parseToNodes(t,i).filter(function(t){return t.nodeType===Node.ELEMENT_NODE})},parseToNode:function(t,i){return this.parseToNodes(t,i)[0]||null},parseToNodes:function(t,i){var e,n=this._document||(this._document=document.implementation.createHTMLDocument(""));return gui.Guide.suspend(function(){return n.body.innerHTML=this._insaneitize(t),e=n.querySelector("."+this._classname)||n.body,Array.map(e.childNodes,function(t){return(i||document).importNode(t,!0)})},this)},parseToDocument:function(t){return t=t||"",gui.Guide.suspend(function(){var i=document.implementation.createHTMLDocument("");if(t.toLowerCase().contains("<!doctype"))try{i.documentElement.innerHTML=t}catch(e){i=new ActiveXObject("htmlfile"),i.open(),i.write(t),i.close()}else i.body.innerHTML=t;return i})},_classname:"_gui-htmlparser",_comments:/<!--[\s\S]*?-->/g,_firsttag:/^<([a-z]+)/i,_document:null,_insaneitize:function(t){var i,e;return t=t.trim().replace(this._comments,""),(i=t.match(this._firsttag))&&(e=this._fixes[i[1]])&&(t=e.replace("${class}",this._classname).replace("${markup}",t)),t},_fixes:function(){var t={td:'<table><tbody><tr class="${class}">${markup}</tr></tbody></table>',tr:'<table><tbody class="${class}">${markup}</tbody></table>',tbody:'<table class="${class}">${markup}</table>',col:'<table><colgroup class="${class}">${markup}</colgroup></table>',option:'<select class="${class}"><option>a</option>${markup}</select>'};return t.th=t.td,["thead","tfoot","caption","colgroup"].forEach(function(i){t[i]=t.tbody}),t}()},gui.DOMSerializer={toString:function(){return"[object gui.DOMParser]"},serialize:function(t){var i=t.ownerDocument.defaultView,e=new i.XMLSerializer;return e.serializeToString(t)},subserialize:function(t){var i=this.serialize(t);return i.contains("</")&&(i=i.slice(i.indexOf(">")+1,i.lastIndexOf("<"))),i}},gui.FileLoader=gui.Class.create(Object.prototype,{onconstruct:function(t){this._cache=gui.FileLoader._cache,this._document=t},load:function(t,i,e){var n=new gui.URL(this._document,t);this._cache.has(n.location)?this._cached(n,i,e):this._request(n,i,e)},onload:function(t,i,e,n){e.call(n,t)},_cache:null,_document:null,_request:function(t,i,e){this._cache.set(t.location,null),new gui.Request(t.href).acceptText().get().then(function(n,r){this.onload(r,t,i,e),this._cache.set(t.location,r),gui.FileLoader.unqueue(t.location)},this)},_cached:function(t,i,e){var n=this._cache.get(t.location);if(null!==n)this.onload(n,t,i,e);else{var r=this;gui.FileLoader.queue(t.location,function(n){r.onload(n,t,i,e)})}},$onconstruct:function(t){if(!t||t.nodeType!==Node.DOCUMENT_NODE)throw new TypeError("Document expected");this.onconstruct(t)}},{},{_cache:new Map,_queue:new Map,queue:function(t,i){this._queue[t]=this._queue[t]||[],this._queue[t].push(i)},unqueue:function(t){var i=this._cache.get(t);if(this._queue[t])for(;this._queue[t][0];)this._queue[t].shift()(i)}}),gui.BlobLoader={loadScript:function(t,i,e,n){var r=new Blob([i],{type:"text/javascript"}),s=t.createElement("script");s.src=this._URL.createObjectURL(r);var o=t.querySelector("head");gui.Observer.suspend(o,function(){o.appendChild(s)}),e&&(s.onload=function(){e.call(n)})},_URL:t.URL||t.webkitURL},gui.EventSummary=function(t){this._construct(t)},gui.EventSummary.prototype={event:null,window:null,document:null,documentspirit:null,toString:function(){return"[object gui.EventSummary]"},_construct:function(t){var i=null,e=null,n=t.target,r=n.nodeType;gui.Type.isDefined(r)?(e=r===Node.DOCUMENT_NODE?n:n.ownerDocument,i=e.defaultView):(i=n,e=i.document),this.event=t,this.window=i,this.document=e,this.documentspirit=e.documentElement.spirit}},gui.Crawler=gui.Class.create(Object.prototype,{type:null,direction:null,global:!1,toString:function(){return"[object gui.Crawler]"},onconstruct:function(t){this.type=t||null},ascend:function(t,i){this.direction=gui.Crawler.ASCENDING;var e,n=t instanceof gui.Spirit?t.element:t;do if(n.nodeType===Node.DOCUMENT_NODE&&(this.global?(e=n.defaultView,e.gui.hosted?e.gui.xhost?(n=null,gui.Type.isFunction(i.transcend)&&i.transcend(e.parent,e.gui.xhost,e.gui.$contextid)):n=e.frameElement:n=null):n=null),n){var r=this._handleElement(n,i);switch(r){case gui.Crawler.STOP:n=null;break;default:n=n.parentNode}}while(n)},ascendGlobal:function(t,i){this.global=!0,this.ascend(t,i),this.global=!1},descend:function(t,i,e){this.direction=gui.Crawler.DESCENDING;var n=t instanceof gui.Spirit?t.element:t;n.nodeType===Node.DOCUMENT_NODE&&(n=n.documentElement),this._descend(n,i,e,!0)},descendGlobal:function(t,i,e){this.global=!0,this.descend(t,i,e),this.global=!1},_descend:function(t,i,e,n){var r,s,o,u,a=this._handleElement(t,i,e);switch(a){case gui.Crawler.CONTINUE:case gui.Crawler.SKIP_CHILDREN:if(a!==gui.Crawler.SKIP_CHILDREN&&(t.childElementCount?this._descend(t.firstElementChild,i,e,!1):this.global&&"iframe"===t.localName&&(u=t.spirit)&&u instanceof gui.IframeSpirit&&(u.xguest?(r=t.ownerDocument.defaultView,gui.Type.isFunction(i.transcend)&&i.transcend(u.contentWindow,u.xguest,u.$instanceid)):(s=t.contentDocument)&&(o=s.documentElement)&&this._descend(o,i,e,!1))),!n){var c=t.nextElementSibling;null!==c&&this._descend(c,i,e,!1)}}},_handleElement:function(t,i,e){var n=gui.Crawler.CONTINUE,r=t.spirit;return r&&(n=r.oncrawler(this)),n||i&&(gui.Type.isFunction(i.handleElement)&&(n=i.handleElement(t,e)),n!==gui.Crawler.STOP&&r&&gui.Type.isFunction(i.handleSpirit)&&(n=this._handleSpirit(r,i))),n||(n=gui.Crawler.CONTINUE),n},_handleSpirit:function(t,i){return i.handleSpirit(t)}},{},{ASCENDING:"ascending",DESCENDING:"descending",CONTINUE:0,STOP:1,SKIP:2,SKIP_CHILDREN:4}),gui.Request=function(t,i){this._headers={Accept:"application/json"},t&&this.url(t,i)},gui.Request.prototype=function(i){return{url:i(function(t,i){this._url=i?new gui.URL(i,t).href:t}),sync:i(function(){this._async=!1}),async:i(function(){this._async=!0}),accept:i(function(t){this._headers.Accept=t}),acceptJSON:i(function(){this.accept("application/json")}),acceptXML:i(function(){this.accept("text/xml")}),acceptText:i(function(){this.accept("text/plain")}),format:i(function(t){this._format=t}),override:i(function(t){this._override=t||!0}),headers:i(function(t){if(!gui.Type.isObject(t))throw new TypeError("Object expected");gui.Object.each(t,function(t,i){this._headers[t]=String(i)},this)}),_async:!0,_url:null,_format:"application/json",_override:!1,_headers:null,_request:function(i,e,n){var r=this,s=new XMLHttpRequest,o=gui.URL.external(this._url,document);o&&t.XDomainRequest&&(s=new XDomainRequest),s.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE){var t=r._response(this.responseText);n(this.status,t,this.responseText)}},this._override&&s.overrideMimeType(this._headers.Accept),s.open(i.toUpperCase(),this._url,!0),o||gui.Object.each(this._headers,function(t,i){s.setRequestHeader(t,i,!1)}),s.send(e)},_response:function(t){var i=t;try{switch(this._headers.Accept){case"application/json":i=JSON.parse(t);break;case"text/xml":i=(new DOMParser).parseFromString(t,"text/xml")}}catch(e){console.error(this._headers.Accept+" dysfunction at "+this._url+"\nNote that gui.Request defaults to accept and send JSON. Use request.accept(mime) and request.format(mime) to change this stuff.")}return i}}}(gui.Combo.chained),["get","post","put","delete"].forEach(function(t){gui.Request.prototype[t]=function(i){if(gui.Type.isFunction(i))throw new Error("Deprecated: gui.Request returns a gui.Then");var e=new gui.Then;return i="get"===t?null:i,this._request(t,i,function(t,i,n){e.now(t,i,n)}),e}}),gui.Module=gui.Class.create(Object.prototype,{plugins:null,mixins:null,channels:null,oncontextinitialize:function(){},onbeforespiritualize:function(){},onafterspiritualize:function(){},oncontextload:function(){},oncontextunload:function(){},$onconstruct:function(t){var i=t.gui.Spirit;gui.Type.isObject(this.mixins)&&i.mixin(this.mixins),gui.Type.isObject(this.plugins)&&gui.Object.each(this.plugins,function(t,e){gui.Type.isDefined(e)?i.plugin(t,e):console.error("Undefined plugin for prefix: "+t)}),gui.Type.isArray(this.channels)&&t.gui.channelModule(this.channels),this.$setupcontext(t)},$setupcontext:function(t){var i=this,e=gui.BROADCAST_WILL_SPIRITUALIZE,n=gui.BROADCAST_DID_SPIRITUALIZE;this.oncontextinitialize&&this.oncontextinitialize(t),gui.Broadcast.addGlobal([e,n],{onbroadcast:function(r){if(r.data===t.gui.$contextid)switch(gui.Broadcast.removeGlobal(r.type,this),r.type){case e:gui.Type.isFunction(i.onbeforespiritualize)&&i.onbeforespiritualize(t);break;case n:gui.Type.isFunction(i.onafterspiritualize)&&i.onafterspiritualize(t)}}})}}),gui.Spirit=gui.Class.create(Object.prototype,{$instanceid:null,$contextid:null,element:null,document:null,window:null,toString:function(){return"[object gui.Spirit]"},onconstruct:function(){},onconfigure:function(){},onenter:function(){},onattach:function(){},onready:function(){},oninit:function(){},ondetach:function(){},onexit:function(){},ondestruct:function(){},onasync:function(){},oncrawler:function(){},$onconstruct:function(t,i,e,n){this.element=t,this.document=i,this.window=e,this.$contextid=n,gui.Spirit.$construct(this)},$ondestruct:function(){},$pluginplugins:function(){var t,i=this.constructor.$plugins;this.life=new gui.LifePlugin(this),this.attconfig=new gui.AttConfigPlugin(this),Object.keys(i).filter(function(t){return"life"!==t&&"attconfig"!==t}).sort().forEach(function(e){t=i[e],(this.life.plugins[e]=!t.lazy)?this[e]=new t(this):gui.Plugin.runonaccessor(this,e,t)},this)},$debug:function(t){var i,e=this.element;t?e.hasAttribute("gui")||(i="["+this.constructor.$classname+"]",e.setAttribute("gui",i)):(i=e.getAttribute("gui"),i&&i.startsWith("[")&&e.removeAttribute("gui"))}},{portals:!0,summon:function(t){return this.possess((t||document).createElement("div"))},possess:function(t){return gui.Guide.possess(t,this)},extend:function(){var t,i=[],e=gui.Class.breakdown(arguments);["name","protos","recurring","statics"].forEach(function(n){(t=e[n])&&i.push(t)},this);var n=gui.Class.extend.apply(this,i);n.$plugins=gui.Object.copy(this.$plugins);var r=gui.Class.breakdown(arguments);return gui.Object.each(n.$plugins,function(t,i){var e=r.protos[t];switch(gui.Type.of(e)){case"object":var s=i.extend(e);n.plugin(t,s,!0);break;case"undefined":break;default:throw new TypeError(n+": Bad definition: "+t)}},this),n},plugin:function(t,i,e){var n=this.$plugins,r=this.prototype;!r.hasOwnProperty(t)||null===r.prefix||e?(!n[t]||e)&&(n[t]=i,r.prefix=null,gui.Class.children(this,function(n){n.plugin(t,i,e)})):console.error("Plugin naming crash in "+this+": "+t)},$plugins:Object.create(null)},{$construct:function(t){t.$pluginplugins(),t.$debug(!0),t.life.constructed=!0,t.onconstruct(),t.life.dispatch(gui.LIFE_CONSTRUCT)},$configure:function(t){t.attconfig.configureall(),t.life.configured=!0,t.onconfigure(),t.life.dispatch(gui.LIFE_CONFIGURE)},$enter:function(t){t.window.gui.inside(t),t.life.entered=!0,t.onenter(),t.life.dispatch(gui.LIFE_ENTER)},$attach:function(t){t.window.gui.inside(t),t.life.attached=!0,t.onattach(),t.life.dispatch(gui.LIFE_ATTACH)},$ready:function(t){t.life.ready=!0,t.onready(),t.life.dispatch(gui.LIFE_READY)},$detach:function(t){t.window.gui.outside(t),t.life.detached=!0,t.life.visible=!1,t.life.dispatch(gui.LIFE_DETACH),t.life.dispatch(gui.LIFE_INVISIBLE),t.ondetach()},$exit:function(t){t.life.exited=!0,t.life.dispatch(gui.LIFE_EXIT),t.onexit()},$async:function(t){t.life.async=!0,t.onasync(),t.life.dispatch(gui.LIFE_ASYNC)},$destruct:function(t){t.$debug(!1),t.life.destructed=!0,t.life.dispatch(gui.LIFE_DESTRUCT),t.ondestruct()},$dispose:function(t){t.$ondestruct(),t.window.gui.destruct(t),gui.GreatSpirit.$meet(t)},$oninit:function(t){t.life.initialized=!0,t.life.dispatch("life-initialized"),t.oninit()}}),gui.Plugin=gui.Class.create(Object.prototype,{spirit:null,context:null,onconstruct:function(){},ondestruct:function(){},handleEvent:function(t){gui.Type.isFunction(this.onevent)&&this.onevent(t)},$onconstruct:function(t){this.spirit=t||null,this.context=t?t.window:null,this.onconstruct()},$ondestruct:function(){gui.GreatSpirit.$nukeallofit(this,self)}},{lazy:!0,infuse:function(){throw new Error('Plugins must use the "extend" method and not "infuse".')}},{runonaccessor:function(t,i,e){Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:function(){var t=new e(this);return this.life.plugins[i]=!0,Object.defineProperty(this,i,{enumerable:!0,configurable:!0,get:function(){return t}}),t}})}}),gui.Tracker=gui.Plugin.extend({onconstruct:function(){this._super.onconstruct(),this._trackedtypes=Object.create(null),this.spirit&&(this._sig=this.spirit.window.gui.$contextid)},ondestruct:function(){this._super.ondestruct(),gui.Object.each(this._trackedtypes,function(t,i){i.slice().forEach(function(i){this._cleanup(t,i)},this)},this)},toggle:function(){console.error("@TODO SpiritTracker#toggle")},contains:function(t){return gui.Array.make(t).every(function(t){return this._trackedtypes[t]},this)},_global:!1,_trackedtypes:null,_sig:null,_globalize:function(t){this._global=!0;var i=t.call(this);return this._global=!1,i},_addchecks:function(t,i){var e=!1,n=this._trackedtypes[t];return n?e=!this._haschecks(n,i):(n=this._trackedtypes[t]=[],e=!0),e&&n.push(i),e},_removechecks:function(t,i){var e=!1,n=this._trackedtypes[t];if(n){var r=this._checksindex(n,i);r>-1&&(e=!0,0===gui.Array.remove(n,r)&&delete this._trackedtypes[t])}return e},_containschecks:function(t,i){var e=!1,n=this._trackedtypes[t];return n&&(e=this._haschecks(n,i)),e},_haschecks:function(t,i){var e=!1;return t.every(function(t){return t.every(function(t,e){return t===i[e]})&&(e=!0),!e}),e},_hashandlers:function(){return Object.keys(this._trackedtypes).length>0},_checksindex:function(t,i){var e=-1;return t.every(function(t,n){return t.every(function(t,e){return t===i[e]})&&(e=n),-1===e}),e},_breakdown:function(t){return gui.Array.make(t)},_cleanup:function(t,i){this._removechecks(t,i)}}),gui.Action=function(t,i,e,n,r){this.target=t,this.type=i,this.data=e,this.direction=n||gui.Action.ASCEND,this.global=r||!1},gui.Action.prototype={target:null,type:null,data:null,direction:null,global:!1,$instanceid:null,isConsumed:!1,isCancelled:!1,consumer:null,consume:function(t){this.isConsumed=!0,this.consumer=t},cancel:function(t){this.isCancelled=!0,this.consume(t)},toString:function(){return"[object gui.Action]"}},gui.Action.DESCEND="descend",gui.Action.ASCEND="ascend",gui.Action.dispatch=function(t,i,e,n,r){var s=new gui.Action(t,i,e,n,r),o=new gui.Crawler(gui.CRAWLER_ACTION);return o.global=r||!1,o[n||"ascend"](t,{handleSpirit:function(t){var e=gui.Crawler.CONTINUE;return t.action.contains(i)&&(t.action.$onaction(s),s.isConsumed&&(e=gui.Crawler.STOP,s.consumer=t)),e},transcend:function(t,i,e){var n=gui.Action.stringify(s,e);t.postMessage(n,"*")}}),s},gui.Action.stringify=function(t,i){var e="spiritual-action:";return e+function(){return t.target=null,t.data=function(t){if(gui.Type.isComplex(t))if(gui.Type.isFunction(t.stringify))t=t.stringify();else try{JSON.stringify(t)}catch(i){t=null}return t}(t.data),t.$instanceid=i||null,JSON.stringify(t)}()},gui.Action.parse=function(t){var i="spiritual-action:";return t.startsWith(i)?JSON.parse(t.split(i)[1]):void 0},gui.ActionPlugin=function(t,i){return gui.Tracker.extend({type:null,data:null,add:t("array|string","(object|function)")(i(function(t,i){i=i?i:this.spirit,gui.Interface.validate(gui.IActionHandler,i)&&gui.Array.make(t).forEach(function(t){this._addchecks(t,[i,this._global])},this)})),remove:t("array|string","(object|function)")(i(function(t,i){i=i?i:this.spirit,gui.Interface.validate(gui.IActionHandler,i)&&gui.Array.make(t).forEach(function(t){this._removechecks(t,[i,this._global])},this)})),addGlobal:function(t,i){return this._globalize(function(){return this.add(t,i)})},removeGlobal:function(t,i){return this._globalize(function(){return this.remove(t,i)})},dispatch:t("string","(*)","(string)")(function(t,i,e){var n=this.spirit,r=this._global;return this._global=!1,e=e||"ascend",gui.Action.dispatch(n,t,i,e,r)}),ascend:function(t,i){return this.dispatch(t,i,"ascend")},descend:function(t,i){return this.dispatch(t,i,"descend")},dispatchGlobal:function(t,i){return this._globalize(function(){return this.dispatch(t,i)})},ascendGlobal:function(t,i){return this._globalize(function(){return this.ascend(t,i)})},descendGlobal:function(t,i){return this._globalize(function(){return this.descend(t,i)})},_cleanup:function(t,i){var e=i[0],n=i[1];n?this.removeGlobal(t,e):this.remove(t,e)},$handleownaction:!1,$onaction:function(t){var i=this._trackedtypes[t.type];i&&i.forEach(function(i){var e=i[0],n=i[1]===t.global,r=e===this.spirit&&this.$handleownaction;n&&(e!==t.target||r)&&e.onaction(t)},this)}})}(gui.Arguments.confirmed,gui.Combo.chained),gui.IActionHandler={toString:function(){return"[object IActionHandler]"},onaction:function(){}},gui.Broadcast=function(t,i){return gui.Class.create(Object.prototype,{target:null,type:null,data:null,global:!1,$contextid:null,$contextids:null,$onconstruct:function(t){gui.Object.extend(this,t),this.$contextids=this.$contextids||[]}},{},{_globals:Object.create(null),_locals:Object.create(null),add:i(function(t,i,e){this._add(t,i,e||gui.$contextid)}),remove:i(function(t,i,e){this._remove(t,i,e||gui.$contextid)}),dispatch:function(t,i,e,n){var r=n||gui.$contextid;return this.$dispatch({target:t,type:i,data:e,global:!1,$contextid:r})},addGlobal:i(function(t,i){this._add(t,i)}),removeGlobal:i(function(t,i){this._remove(t,i)}),dispatchGlobal:function(t,i,e){return this.$dispatch({target:t,type:i,data:e,global:!0,$contextid:gui.$contextid})},stringify:function(t){var i="spiritual-broadcast:";return i+function(){return t.target=null,t.data=function(t){if(gui.Type.isComplex(t))if(gui.Type.isFunction(t.stringify))t=t.stringify();else try{JSON.stringify(t)}catch(i){t=null}return t}(t.data),JSON.stringify(t)}()},parse:function(t){var i="spiritual-broadcast:";return t.startsWith(i)?JSON.parse(t.split(i)[1]):void 0},_add:t("array|string","object|function","(string)")(function(t,i,e){if(gui.Interface.validate(gui.IBroadcastHandler,i))if(gui.Type.isArray(t))t.forEach(function(t){this._add(t,i,e)},this);else{var n;e?(n=this._locals[e],n||(n=this._locals[e]=Object.create(null))):n=this._globals,n[t]||(n[t]=[]);var r=n[t];-1===r.indexOf(i)&&r.push(i)}}),_remove:function(t,i,e){if(gui.Interface.validate(gui.IBroadcastHandler,i))if(gui.Type.isArray(t))t.forEach(function(t){this._remove(t,i,e)},this);else{var n,r=function(i,n){return e?i[e]?i[e][t]:void 0:n[t]}(this._locals,this._globals);r&&(n=r.indexOf(i),n>-1&&gui.Array.remove(r,n))}},$dispatch:function(t){var i=t.global?this._globals:this._locals[t.$contextid];if(t instanceof gui.Broadcast==!1&&(t=new gui.Broadcast(t)),i){var e=i[t.type];e&&e.slice().forEach(function(i){i.onbroadcast(t)})}if(t.global){var n=document.documentElement.spirit;n&&n.propagateBroadcast(t)}return t}})}(gui.Arguments.confirmed,gui.Combo.chained),gui.BroadcastPlugin=function(t,i){return gui.Tracker.extend({add:i("string|array")(t(function(t,i){i=i?i:this.spirit;var e=this._global?null:this._sig;gui.Array.make(t).forEach(function(t){this._addchecks(t,[i,this._global])&&(this._global?gui.Broadcast.addGlobal(t,i):gui.Broadcast.add(t,i,e))},this)})),remove:i("string|array")(t(function(t,i){i=i?i:this.spirit;var e=this._global?null:this._sig;gui.Array.make(t).forEach(function(t){this._removechecks(t,[i,this._global])&&(this._global?gui.Broadcast.removeGlobal(t,i):gui.Broadcast.remove(t,i,e))},this)})),dispatch:i("string|array")(function(t,i){var e=null,n=this._global,r=n?null:this._sig;return this._global=!1,gui.Array.make(t).forEach(function(t){e=n?gui.Broadcast.dispatchGlobal(this.spirit,t,i):gui.Broadcast.dispatch(this.spirit,t,i,r)},this),e}),addGlobal:function(t,i){return this._globalize(function(){return this.add(t,i)})},removeGlobal:function(t,i){return this._globalize(function(){return this.remove(t,i)})},dispatchGlobal:function(t,i){return this._globalize(function(){return this.dispatch(t,i)})},_cleanup:function(t,i){{var e=i[0],n=i[1];n?null:this._sig}n?gui.Broadcast.removeGlobal(t,e):gui.Broadcast.remove(t,e,this._sig)}})}(gui.Combo.chained,gui.Arguments.confirmed),gui.IBroadcastHandler={toString:function(){return"[object IBroadcastHandler]"},onbroadcast:function(){}},function(t){gui.Tick=function(t){this.type=t},gui.Tick.prototype={type:null,toString:function(){return"[object gui.Tick]"}},gui.Tick.toString=function(){return"[function gui.Tick]"},gui.Tick._global={types:Object.create(null),handlers:Object.create(null)},gui.Tick._local=Object.create(null),gui.Tick.add=t("string|array","object|function","(string)")(function(t,i,e){return this._add(t,i,!1,e||gui.$contextid)}),gui.Tick.one=t("string|array","object|function","(string)")(function(t,i,e){return this._add(t,i,!0,e||gui.$contextid)}),gui.Tick.next=function(t,i){setImmediate(function(){t.call(i)})},gui.Tick.nextFrame=function(t,i){return requestAnimationFrame(function(e){t.call(i,e)})},gui.Tick.time=function(t,i,e){return setTimeout(function(){t.call(e)},i)},gui.Tick.remove=function(t,i,e){return this._remove(t,i,e||gui.$contextid)},gui.Tick.start=function(){console.error("@TODO gui.Tick.start")},gui.Tick.stop=function(){console.error("@TODO gui.Tick#stop")},gui.Tick.dispatch=function(t,i,e){return this._dispatch(t,i,e||gui.$contextid)},gui.Tick.addGlobal=t("string|array","object|function")(function(t,i){return this._add(t,i,!1,null)}),gui.Tick.oneGlobal=function(t,i){return this.add(t,i,!0,null)},gui.Tick.removeGlobal=function(t,i){return this._remove(t,i,null)},gui.Tick.dispatchGlobal=function(t,i){return this._dispatch(t,i,null)},gui.Tick._add=function(t,i,e,n){if(gui.Type.isArray(t))t.forEach(function(t){this._add(t,i,e,n)},this);else{var r,s,o=n?this._local[n]:this._global;o||(o=this._local[n]={types:Object.create(null),handlers:Object.create(null)}),r=o.handlers[t],r||(r=o.handlers[t]=[]),s=r.indexOf(i),0>s&&(s=r.push(i)-1),e&&(r._one=r._one||Object.create(null),r._one[s]=!0)}return this},gui.Tick._remove=function(t,i,e){if(gui.Type.isArray(t))t.forEach(function(t){this.remove(t,i,e)},this);else{var n=e?this._local[e]:this._global,r=n.handlers[t];if(r){var s=r.indexOf(i);0===gui.Array.remove(r,s)&&delete n.handlers[t]}}return this},gui.Tick._dispatch=function(t,i,e){var n=e?this._local[e]:this._global,r=n.types,s=new gui.Tick(t);if(gui.Type.isDefined(i)){if(!r[t]){var o=this,u=null;u=0===i?setImmediate(function(){o._dispatch(t,void 0,e),delete r[t]}):setTimeout(function(){o._dispatch(t,void 0,e),delete r[t]},i),r[t]=u}}else{var a=n.handlers[t];a&&a.slice().forEach(function(t){t.ontick(s)})}return s}}(gui.Arguments.confirmed),gui.TickPlugin=function(t){return gui.Tracker.extend({add:t(function(t,i){i=i?i:this.spirit,gui.Interface.validate(gui.ITickHandler,i)&&gui.Array.make(t).forEach(function(t){this._addchecks(t,[i,this._global])&&this._add(t,i,!1)},this)}),remove:t(function(t,i){i=i?i:this.spirit,gui.Interface.validate(gui.ITickHandler,i)&&gui.Array.make(t).forEach(function(t){this._removechecks(t,[i,this._global])&&this._remove(t,i)},this)}),one:t(function(t,i){this.add(t,i,!0)}),next:t(function(t,i){gui.Tick.next(t,i||this.spirit)}),nextFrame:t(function(t,i){gui.Tick.nextFrame(t,i||this.spirit)}),time:t(function(t,i,e){gui.Tick.time(t,i,e||this.spirit)}),dispatch:function(t,i){return this._dispatch(t,i||0)},_global:!1,_add:function(t,i,e){var n=this.spirit.$contextid;e?this._global?gui.Tick.oneGlobal(t,i):gui.Tick.one(t,i,n):this._global?gui.Tick.addGlobal(t,i):gui.Tick.add(t,i,n)},_remove:function(t,i){var e=this.spirit.$contextid;this._global?gui.Tick.removeGlobal(t,i):gui.Tick.remove(t,i,e)},_dispatch:function(t,i){var e,n=this.spirit.$contextid;return e=this._global?gui.Tick.dispatchGlobal(t,i):gui.Tick.dispatch(t,i,n)},_cleanup:function(t,i){var e=i[0],n=i[1];this._remove(t,[e])&&(n?gui.Tick.removeGlobal(t,e):gui.Tick.remove(t,e,this.$contextid))}})}(gui.Combo.chained),gui.ITickHandler={toString:function(){return"[object ITickHandler]"},ontick:function(){}},gui.module("core",{plugins:{action:gui.ActionPlugin,broadcast:gui.BroadcastPlugin,tick:gui.TickPlugin},mixins:{onaction:function(){},onbroadcast:function(){},ontick:function(){}}}),gui.Client=new function(){function i(t){var i=document.documentElement,e=t[0].toUpperCase()+t.substring(1);return!["","Webkit","Moz","O","ms"].every(function(n){return void 0===i.style[n?n+e:t]})}function e(){var i=t,e=document,n=e.documentElement,r=e.body,s=null,o=r.appendChild(gui.CSSPlugin.style(e.createElement("div"),{position:"absolute",height:"10px",width:"10px",top:"100%"}));i.scrollBy(0,10),s=r.scrollTop?r:n,this.scrollRoot=s,gui.CSSPlugin.style(o,{position:"fixed",top:"10px"});var u=10===o.getBoundingClientRect().top;this.hasPositionFixed=u,r.removeChild(o),i.scrollBy(0,-10);var a=gui.CSSPlugin.style(document.createElement("p"),{width:"100%",height:"200px"}),c=gui.CSSPlugin.style(document.createElement("div"),{position:"absolute",top:"0",left:"0",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"});c.appendChild(a),n.appendChild(c);var l=a.offsetWidth;c.style.overflow="scroll";var h=a.offsetWidth;l===h&&(h=c.clientWidth),n.removeChild(c),this.scrollBarSize=l-h,this.isExplorer&&(this.scrollBarSize=17)}{var n=navigator.userAgent.toLowerCase();document.documentElement}this.isExplorer=n.contains("msie")||n.contains("trident"),this.isExplorer9=this.isExplorer&&n.contains("msie 9"),this.isOpera=n.contains("opera"),this.isWebKit=n.contains("webkit"),this.isChrome=this.isWebKit&&n.contains("chrome"),this.isSafari=this.isWebKit&&!this.isChrome&&n.contains("safari"),this.isGecko=!this.isWebKit&&!this.isOpera&&n.contains("gecko"),this.agent=function(){var t="explorer";return this.isWebKit?t="webkit":this.isGecko?t="gecko":this.isOpera&&(t="opera"),t}.call(this),this.system=function(){var t=null;return["window mobile","windows","ipad","iphone","haiku","os x","linux"].every(function(i){return n.contains(i)&&(t=i.match(/ipad|iphone/)?"ios":i.replace(/ /g,"")),null===t}),t}(),this.hasTouch=void 0!==t.ontouchstart||this.isChrome,this.hasPointers=this.isExplorer&&!this.isExplorer9,this.hasBlob=t.Blob&&(t.URL||t.webkitURL),this.hasHistory=t.history&&t.history.pushState?!0:!1,this.isMobile=function(){var t=["android","webos","iphone","ipad","ipod","blackberry","windows phone"];return!t.every(function(t){return!n.contains(t)})}(),this.hasTransitions=i("transition"),this.has3D=i("perspective"),this.hasFlexBox=i("flex"),this.hasAnimationFrame=function(){var i=t;return i.requestAnimationFrame||i.webkitRequestAnimationFrame||i.mozRequestAnimationFrame||i.msRequestAnimationFrame||i.oRequestAnimationFrame?!0:!1}(),this.hasMutations=function(){return!["","WebKit","Moz","O","Ms"].every(function(i){return!gui.Type.isDefined(t[i+"MutationObserver"])})}(),this.STABLETIME=200,this.scrollRoot=null,this.scrollBarSize=0,this.hasPositionFixed=!1,this.onbroadcast=function(t){var i=gui.BROADCAST_WILL_SPIRITUALIZE;t.type===i&&t.target===gui&&(gui.Broadcast.removeGlobal(i,this),e.call(this))}},function(){gui.Broadcast.addGlobal(gui.BROADCAST_WILL_SPIRITUALIZE,gui.Client)}(),gui.Observer={observes:gui.Client.hasMutations,fails:!1,observe:function(t){t.gui.debug&&this._observe(t)},suspend:function(t,i,e){var n;if(!t.nodeType)throw new TypeError;return this.observes&&1===++this._suspend&&this._connect(t,!1),gui.Type.isFunction(i)&&(n=i.call(e)),this.observes&&this.resume(t),n},resume:function(t){if(!t.nodeType)throw new TypeError;this.observes&&0===--this._suspend&&this._connect(t,!0)},_suspend:0,_observers:Object.create(null),_observe:function(t){var i=t.gui.$contextid,e=t.document,n=this._observers[i];if(this.observes){if(!gui.Type.isDefined(n)){var r=this._mutationobserver();n=this._observers[i]=new r(function(t){t.forEach(function(t){gui.Observer._handleMutation(t)})})}this._connect(e,!0)}},_mutationobserver:function(){return t.MutationObserver||t.WebKitMutationObserver||t.MozMutationObserver},_connect:function(t,i){var e=t.ownerDocument||t,n=e.defaultView,r=n.gui.$contextid,s=this._observers[r];s&&(i?s.observe(e,{childList:!0,subtree:!0}):s.disconnect())},_handleMutation:function(t){var i=!1;Array.forEach(t.removedNodes,function(t){t.nodeType===Node.ELEMENT_NODE&&(console.warn("Bad remove:",t),i=!0)}),Array.forEach(t.addedNodes,function(t){t.nodeType===Node.ELEMENT_NODE&&(console.warn("Bad append:",t),i=!0)}),i&&console[this.fails?"error":"warn"](this._message())},_message:function(){return["Action required: DOM mutation not intercepted, Spiritual may be out of synch.","While we wait for http://code.google.com/p/chromium/issues/detail?id=13175,","please use the these methods to replace innerHTML, textContent and outerHTML:","    gui.DOMPlugin.html(node,string)","    gui.DOMPlugin.text(node,string)","    gui.DOMPlugin.outerHtml(node,string)","Tip: You can use insertAdjecantHTML instead of innerHTML for bonus performance."].join("\n")}},gui.Guide={toString:function(){return"[object gui.Guide]"},observe:function(t){t.document.addEventListener("DOMContentLoaded",this,!1),t.addEventListener("load",this,!1),t.addEventListener("unload",this,!1)},handleEvent:function(t){var i=new gui.EventSummary(t);switch(t.type){case"DOMContentLoaded":this._ondom(i);break;case"load":this._onload(i);break;case"unload":this._unload(i)}t.currentTarget.removeEventListener(t.type,this,!1),t.stopPropagation()},onbroadcast:function(i){var e=i.data,n=null,r=this._windows[e];switch(i.type){case gui.BROADCAST_KICKSTART:gui.Broadcast.removeGlobal(i.type,this),this._step1(t,document);break;case gui.BROADCAST_LOADING_CHANNELS:r||(r=this._windows[e]=[],r.$loading=0),r.push(i.target),r.$loading++;break;case gui.BROADCAST_CHANNELS_LOADED:if(0===--r.$loading){for(;n=r.shift();)n.channel();this._step2(i.target.document)}}},spiritualize:function(t){t=t instanceof gui.Spirit?t.element:t,this._maybespiritualize(t,!1,!1)},spiritualizeSub:function(t){this._maybespiritualize(t,!0,!1)},spiritualizeOne:function(t){this._maybespiritualize(t,!1,!0)},materialize:function(t){this._maybematerialize(t,!1,!1)},materializeSub:function(t){this._maybematerialize(t,!0,!1)},materializeOne:function(t){this._maybematerialize(t,!1,!0)},detach:function(t){this._maybedetach(t)},possess:function(t,i){var e=t.ownerDocument,n=e.defaultView,r=n.gui.$contextid;if(t.spirit)throw new Error("Cannot repossess element with spirit "+t.spirit+" (exorcise first)");return t.spirit=new i(t,e,n,r),t.spirit},exorcise:function(t){t.life.destructed||(gui.Spirit.$destruct(t),gui.Spirit.$dispose(t))},suspend:function(t,i){this._suspended=!0;var e=t.call(i);return this._suspended=!1,e},_windows:Object.create(null),_suspended:!1,_handles:function(t){return t&&!this._suspended&&gui.DOMPlugin.embedded(t)&&t.nodeType===Node.ELEMENT_NODE},_ondom:function(t){if(t.documentspirit&&t.documentspirit.ondom(),gui.autostart){var i=t.document.querySelector("meta[name='gui.autostart']");i&&gui.Type.cast(i.getAttribute("content"))===!1||this._step1(t.window,t.document)
}},_onload:function(t){t.documentspirit&&t.documentspirit.onload()},_unload:function(t){t.documentspirit&&t.documentspirit.onunload(),this.materialize(t.document),t.window.gui.nameDestructAlreadyUsed()},_step1:function(t,i){var e=t.gui.$contextid;gui.Broadcast.removeGlobal(gui.BROADCAST_KICKSTART,this),this._metatags(t),t.gui.start().then(function(){this._stylesheets(t),this._windows[e]||this._step2(t,i)},this)},_step2:function(t,i){var e=t.gui.$contextid;gui.DOMChanger.setup(t),gui.broadcastGlobal(gui.BROADCAST_WILL_SPIRITUALIZE,e),this._spastiker(t,i),gui.broadcastGlobal(gui.BROADCAST_DID_SPIRITUALIZE,e)},_spastiker:function(t,i){var e=i.documentElement;this.spiritualizeOne(e),t.gui.mode!==gui.MODE_MANAGED&&(t.gui.mode===gui.MODE_NATIVE&&(gui.DOMChanger.change(t),t.gui.debug&&gui.Observer.observe(t)),this.spiritualizeSub(e),t.gui.$onready())},_metatags:function(t){var i=t.document,e=t.gui.namespaces(),n=i.querySelectorAll("meta[name]");Array.forEach(n,function(i){var n=i.getAttribute("name");e.forEach(function(e){if(n.startsWith(e+".")){var r=gui.Type.cast(i.getAttribute("content"));gui.Object.assert(n,r,t)}})})},_stylesheets:function(t){var i=t.document,e=".gui-styles",n=i.querySelectorAll(e);Array.forEach(n,function(t){this.spiritualizeOne(t)},this)},_collect:function(t,i,e){var n=[];return new gui.Crawler(e).descend(t,{handleSpirit:function(e){i&&e.element===t||e.life.destructed||n.push(e)}}),n},_maybespiritualize:function(t,i,e){t=t instanceof gui.Spirit?t.element:t,t=t.nodeType===Node.DOCUMENT_NODE?t.documentElement:t,this._handles(t)&&this._spiritualize(t,i,e)},_spiritualize:function(t,i,e){var n=[],r=[];new gui.Crawler(gui.CRAWLER_SPIRITUALIZE).descend(t,{handleElement:function(r){if(!i||r!==t){var s=r.spirit;s||(s=gui.Guide._evaluate(r)),null!==s&&(s.life.attached||n.push(s))}return e?gui.Crawler.STOP:gui.Crawler.CONTINUE}}),n.forEach(function(t){t.life.configured||gui.Spirit.$configure(t),t.life.entered||gui.Spirit.$enter(t),gui.Spirit.$attach(t),t.life.ready||r.push(t)},this),r.reverse().forEach(function(t){gui.Spirit.$ready(t)})},_maybematerialize:function(t,i,e,n){t=t instanceof gui.Spirit?t.element:t,t=t.nodeType===Node.DOCUMENT_NODE?t.documentElement:t,(n||this._handles(t))&&this._materialize(t,i,e)},_materialize:function(t,i){this._collect(t,i,gui.CRAWLER_MATERIALIZE).reverse().filter(function(t){return t.life.attached&&!t.life.destructed?(gui.Spirit.$destruct(t),!0):!1}).forEach(function(t){gui.Spirit.$dispose(t)})},_maybedetach:function(t){t=t instanceof gui.Spirit?t.element:t,this._handles(t)&&this._collect(t,!1,gui.CRAWLER_DETACH).forEach(function(t){gui.Spirit.$detach(t)})},_evaluate:function(t){if(!t.spirit){var i=t.ownerDocument,e=i.defaultView,n=e.gui.evaluate(t);n&&this.possess(t,n)}return t.spirit},_visibility:function(t){gui.DOMPlugin.group(t).forEach(function(t){gui.VisibilityPlugin.$init(t)},this)},$goasync:function(t){t.forEach(function(t){gui.Spirit.$async(t)}),this._visibility(t)}},function(){gui.Guide.observe(t),gui.Broadcast.addGlobal([gui.BROADCAST_LOADING_CHANNELS,gui.BROADCAST_CHANNELS_LOADED,gui.BROADCAST_KICKSTART],gui.Guide)}(),gui.DOMChanger={setup:function(t){var i=t.Element.prototype;if(gui.Type.isDefined(i.spirit))throw new Error("Spiritual loaded twice?");i.spirit=null},change:function(t){this.upgrade(t,gui.DOMCombos)},upgrade:function(t,i){this._change(t,i)},_change:function(t,i){var e=[],n=t.document;this._canchange(t.Element.prototype,t,i)||t.HTMLElement&&this._canchange(t.HTMLElement.prototype,t)||this._tags().forEach(function(r){var s=n.createElement(r),o=s.constructor.prototype;o!==t.Object.prototype&&-1===e.indexOf(o)&&(this._dochange(o,t,i),e.push(o))},this)},_tags:function(){return"a abbr address area article aside audio b base bdi bdo blockquote body br button canvas caption cite code col colgroup command datalist dd del details device dfn div dl dt em fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins kbd keygen label legend li link main map menu meta meter nav noscript ol optgroup option output p param pre progress q rp rt ruby s samp script section select small source span strong style submark summary sup table tbody td textarea tfoot th thead time title tr track ul unknown var video wbr".split(" ")},_canchange:function(t,i,e){var n=!1,r="it appears to work",s=t.hasChildNodes;t.hasChildNodes=function(){return r};var o=i.document.documentElement;return o.hasChildNodes()===r&&(t.hasChildNodes=s,this._dochange(t,i,e),n=!0),n},_dochange:function(t,i,e){var n=i.document.documentElement;gui.Object.each(e,function(i,e){this._docombo(t,i,e,n)},this)},_docombo:function(t,i,e){this._ismethod(i)&&this._domethod(t,i,e)},_ismethod:function(t){var i=!1;switch(t){case"appendChild":case"removeChild":case"insertBefore":case"replaceChild":case"setAttribute":case"removeAttribute":case"insertAdjecantHTML":i=!0}return i},_domethod:function(t,i,e){var n=t[i];t[i]=e(function(){return n.apply(this,arguments)})},_doie:function(t,i,e){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(t,i,{get:function(){return n.get.call(this)},set:e(function(){n.apply(this,arguments)})})},_dogecko:function(t,i,e,n){var r=n.__lookupGetter__(i),s=n.__lookupSetter__(i);r&&(t.__defineGetter__(i,function(){return r.apply(this,arguments)}),t.__defineSetter__(i,e(function(){s.apply(this,arguments)})))}},gui.DOMCombos=function(){var t=gui.Combo,i=t.before,e=t.after,n=t.around,r=t.provided,s=r(function(){return gui.DOMPlugin.embedded(this)}),o=r(function(){return!gui.Type.isNull(this.spirit)}),u=e(function(t){gui.Guide.spiritualize(t)}),a=e(function(t){gui.Guide.spiritualize(t)}),c=i(function(t,i){gui.Guide.materialize(i)}),l=i(function(t){gui.Guide.detach(t)}),h=i(function(t,i){this.spirit.att.set(t,i)}),d=i(function(t){this.spirit.att.del(t)}),f=n(function(t){return gui.Observer.suspend(this,function(){return t()},this)}),g=(i(function(t){gui.Guide.materialize(t)}),i(function(){gui.Guide.materializeSub(this)})),p=e(function(){gui.Guide.spiritualizeSub(this)}),m=null,_=i(function(){m=this.parentNode,gui.Guide.materialize(this)}),v=e(function(){gui.Guide.spiritualize(m)}),b=e(function(t){console.log(t)}),y=r(function(){var t=this.ownerDocument.defaultView;return t?t.gui.mode!==gui.MODE_MANAGED:!1}),O=function(t){return t};return{appendChild:function(t){return y(s(u(f(t)),O(t)),O(t))},removeChild:function(t){return y(s(l(f(t)),O(t)),O(t))},insertBefore:function(t){return y(s(u(f(t)),O(t)),O(t))},replaceChild:function(t){return y(s(c(a(f(t))),O(t)),O(t))},setAttribute:function(t){return y(s(o(h(t),O(t)),O(t)),O(t))},removeAttribute:function(t){return y(s(o(d(t),O(t)),O(t)),O(t))},insertAdjecantHTML:function(t){return y(s(b(f(t))),O(t)),O(t)},innerHTML:function(t){return y(s(g(p(f(t))),O(t)),O(t))},outerHTML:function(t){return y(s(_(v(f(t))),O(t)),O(t))},textContent:function(t){return y(s(g(f(t)),O(t)),O(t))}}}(),gui.GreatSpirit={DENIAL:"Attempt to handle destructed spirit",toString:function(){return"[object gui.GreatSpirit]"},ontick:function(t){var i,e=this._spirits.slice();if(t.type===gui.$TICK_DESTRUCT){for(;i=e.shift();)this.$nuke(i);this._spirits=[]}},$meet:function(t){this._spirits.push(t),gui.Tick.dispatch(gui.$TICK_DESTRUCT,0)},$nuke:function(t){var i=[],e=t.life.plugins;gui.Object.each(e,function(e,n){n?"life"!==e&&i.push(e):Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){},set:function(){}})}),this.$nukeplugins(t,i.sort()),this.$nukeplugins(t,["life"]),this.$nukeelement(t),this.$nukeallofit(t,t.window)},$nukeplugins:function(t,i){var e=i.map(function(i){return t[i]},this);e.forEach(function(t){t.ondestruct()}),e.forEach(function(t){t.$ondestruct()})},$nukeelement:function(t){try{t.element.spirit=null}catch(i){}},$nukeallofit:function(t,i){var e=i.Object.prototype;for(var n in t)if((t.hasOwnProperty(n)||gui.debug)&&void 0===e[n]){var r=Object.getOwnPropertyDescriptor(t,n);(!r||r.configurable)&&(i.gui.debug?this._definePropertyItentified(t,n):Object.defineProperty(t,n,this.DENIED))}},DENIED:{enumerable:!0,configurable:!0,get:function(){gui.GreatSpirit.DENY()},set:function(){gui.GreatSpirit.DENY()}},DENY:function(t){var i,e=new Error(gui.GreatSpirit.DENIAL+(t?": "+t:""));throw!gui.Client.isExplorer&&(i=e.stack)?(i=gui.Client.isWebKit?i.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@").split("\n"):i.split("\n"),i.shift(),i.shift(),new Error(e.message+"\n"+i)):e},_spirits:[],_definePropertyItentified:function(t,i){Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:function(){gui.GreatSpirit.DENY(t)},set:function(){gui.GreatSpirit.DENY(t)}})}},gui.Tick.add(gui.$TICK_DESTRUCT,gui.GreatSpirit),gui.Life=function(t,i){this.target=t,this.type=i},gui.Life.prototype={target:null,type:null,toString:function(){return"[object gui.Life]"}},gui.LifePlugin=gui.Tracker.extend({constructed:!1,configured:!1,entered:!1,attached:!1,detached:!0,ready:!1,async:!1,exited:!1,destructed:!1,visible:void 0,plugins:null,onconstruct:function(){this._super.onconstruct(),this._handlers=Object.create(null),this.plugins=Object.create(null)},add:function(t,i){return i=i?i:this.spirit,gui.Array.make(t).forEach(function(t){this._addchecks(t,[i])&&(this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(i))},this),this.spirit},remove:function(t,i){return i=i?i:this.spirit,gui.Array.make(t).forEach(function(t){if(this._removechecks(t,[i])){var e=this._handlers[t].indexOf(t);gui.Array.remove(this._handlers[t],e),0===this._handlers[t].length&&delete this._handlers[t]}},this),this.spirit},dispatch:function(t){var i=this._handlers[t];if(void 0!==i){var e=new gui.Life(this.spirit,t);switch(i.forEach(function(t){t.onlife(e)}),t){case gui.Life.CONSTRUCT:case gui.Life.CONFIGURE:case gui.Life.ENTER:case gui.Life.READY:case gui.Life.DETACH:case gui.Life.EXIT:case gui.Life.DESTRUCT:delete this._handlers[t]}}},_handlers:null,_cleanup:function(t,i){var e=i[0];this.remove(t,e)}}),gui.AttConfigPlugin=gui.Plugin.extend({configureall:function(){var t=this.spirit.element.attributes;Array.forEach(t,function(t){this.configureone(t.name,t.value)},this)},configureone:function(t,i){var e,n=this.spirit.window.gui;n.attributes.every(function(n){return(e=t!==n&&t.startsWith(n))&&this.$evaluate(t,i,n),!e},this)},$evaluate:function(t,i,e){var n=this.spirit,r=!0,s=null,o=null;t=s=t.split(e+".")[1],t.indexOf(".")>-1&&(o=t.split("."),o.forEach(function(t,i){gui.Type.isDefined(n)?i<o.length-1?n=n[t]:s=t:r=!1})),r&&gui.Type.isDefined(n[s])?(gui.Type.isString(i)&&(i=gui.Type.cast(i)),gui.Type.isFunction(n[s])?n[s](i):n[s]=i):(console.error('No definition for "'+t+'": '+this.spirit.toString()),console.error(n[s]))}},{lazy:!1}),gui.Att=function(t,i){this.value=gui.Type.cast(i),this.name=this.type=t},gui.Att.prototype={name:null,type:null,value:null},gui.AttPlugin=function(t,i){return gui.Tracker.extend({get:function(t){return gui.AttPlugin.get(this.spirit.element,t)},set:i(function(t,i){this.$suspended||gui.AttPlugin.set(this.spirit.element,t,i)}),has:function(t){return gui.AttPlugin.has(this.spirit.element,t)},del:i(function(t){this.$suspended||gui.AttPlugin.del(this.spirit.element,t)}),all:function(){return gui.AttPlugin.all(this.spirit.element)},getmap:function(){return gui.AttPlugin.getmap(this.spirit.element)},setmap:function(t){gui.AttPlugin.setmap(this.spirit.element,t)},add:t("array|string","(object|function)")(i(function(t,i){i=i?i:this.spirit,gui.Interface.validate(gui.IAttHandler,i)&&gui.Array.make(t).forEach(function(t){this._addchecks(t,[i]),this._onadd(t)},this)})),remove:t("array|string","(object|function)")(i(function(t,i){i=i?i:this.spirit,gui.Interface.validate(gui.IAttHandler,i)&&gui.Array.make(t).forEach(function(t){this._removechecks(t,[i])},this)})),$suspended:!1,$suspend:function(t){this.$suspended=!0;var i=t();return this.$suspended=!1,i},$onatt:function(t,i){{var e,n,r,s;!gui.attributes.every(function(e){return(s=t.startsWith(e))&&this.spirit.attconfig.configureone(t,i),!s},this)}!s&&(e=this._trackedtypes[t])&&(n=new gui.Att(t,i),e.forEach(function(t){r=t[0],r.onatt(n)},this))},_onadd:function(t){if(this.has(t)){var i=this.get(t);t.startsWith(gui.AttConfigPlugin.PREFIX)?this.spirit.attconfig.configureone(t,i):this.$onatt(t,i)}}},{},{get:function(t,i){return gui.Type.cast(t.getAttribute(i))},set:i(function(t,i,e){var n=t.spirit,r=!1;this._ischecked(t,i)?(r=t.checked!==e,t.checked="false"===String(e)?!1:null!==e,r&&n.att.$onatt(i,e)):this._isvalue(t,i)?(r=t.value!==String(e),r&&(t.value=String(e),n.att.$onatt(i,e))):null===e?this.del(t,i):(e=String(e),t.getAttribute(i)!==e&&(n?(n.att.$suspend(function(){t.setAttribute(i,e)}),n.att.$onatt(i,e)):t.setAttribute(i,e)))}),_ischecked:function(t,i){return t.type&&void 0!==t.checked&&"checked"===i},_isvalue:function(t,i){return void 0!==t.value&&"value"===i},has:function(t,i){return t.hasAttribute(i)},del:i(function(t,i){var e=t.spirit;this._ischecked(t,i)?t.checked=!1:this._isvalue(t,i)?t.value="":e?(e.att.$suspend(function(){t.removeAttribute(i)}),e.attconfig.configureone(i,null)||e.att.$onatt(i,null)):t.removeAttribute(i)}),all:function(t){return gui.Array.from(t.attributes)},getmap:function(t){var i=Object.create(null);return this.all(t).forEach(function(t){i[t.name]=gui.Type.cast(t.value)}),i},setmap:i(function(t,i){gui.Object.each(i,function(i,e){this.set(t,i,e)},this)})})}(gui.Arguments.confirmed,gui.Combo.chained),gui.IAttHandler={toString:function(){return"[object IAttHandler]"},onatt:function(){}},gui.BoxPlugin=gui.Plugin.extend({width:0,height:0,localX:0,localY:0,pageX:0,pageY:0,clientX:0,clientY:0,_scrollroot:function(){return function(t){return"html"===gui.Client.scrollRoot.localName?t.documentElement:t.body}(this.spirit.document)}}),Object.defineProperties(gui.BoxPlugin.prototype,{width:{get:function(){return this.spirit.element.offsetWidth}},height:{get:function(){return this.spirit.element.offsetHeight}},localX:{get:function(){return this.spirit.element.offsetLeft}},localY:{get:function(){return this.spirit.element.offsetTop}},pageX:{get:function(){return this.clientX+this._scrollroot().scrollLeft}},pageY:{get:function(){return this.clientY+this._scrollroot().scrollTop}},clientX:{get:function(){return this.spirit.element.getBoundingClientRect().left}},clientY:{get:function(){return this.spirit.element.getBoundingClientRect().top}}}),gui.CSSPlugin=function(t){return gui.Plugin.extend({add:t(function(t){gui.CSSPlugin.add(this.spirit.element,t)}),remove:t(function(t){gui.CSSPlugin.remove(this.spirit.element,t)}),toggle:t(function(t){gui.CSSPlugin.toggle(this.spirit.element,t)}),shift:t(function(t,i){gui.CSSPlugin.shift(this.spirit.element,t,i)}),contains:function(t){return gui.CSSPlugin.contains(this.spirit.element,t)},set:t(function(t,i){gui.CSSPlugin.set(this.spirit.element,t,i)}),style:t(function(t){gui.CSSPlugin.style(this.spirit.element,t)}),get:function(t){return gui.CSSPlugin.get(this.spirit.element,t)},compute:function(t){return gui.CSSPlugin.compute(this.spirit.element,t)},name:t(function(t){var i=this.spirit.element.className;return void 0!==t&&(this.spirit.element.className=t,i=this.spirit),i}),matches:function(t){return gui.CSSPlugin.matches(this.spirit.element,t)}},{},{add:t(function(t,i){if(gui.Type.isString(i))if(i.indexOf(" ")>-1&&(i=i.split(" ")),gui.Type.isArray(i))i.forEach(function(i){this.add(t,i)},this);else if(this._supports)t.classList.add(i);else{var e=t.className.split(" ");-1===e.indexOf(i)&&(e.push(i),t.className=e.join(" "))}}),remove:t(function(t,i){if(gui.Type.isString(i))if(i=i||"",i.indexOf(" ")>-1&&(i=i.split(" ")),gui.Type.isArray(i))i.forEach(function(i){this.remove(t,i)},this);else if(this._supports)t.classList.remove(i);else{var e=t.className.split(" "),n=e.indexOf(i);n>-1&&gui.Array.remove(e,n),t.className=e.join(" ")}}),toggle:t(function(t,i){gui.Type.isString(i)&&(this._supports?t.classList.toggle(i):this.contains(t,i)?this.remove(t,i):this.add(t,i))}),shift:t(function(t,i,e){e?this.add(t,i):this.remove(t,i)}),contains:function(t,i){if(this._supports)return t.classList.contains(i);var e=t.className.split(" ");return e.indexOf(i)>-1},set:t(function(t,i,e){gui.Type.isNumber(e)&&(e=(this._shorthands[i]||"@").replace("@",e)),e=String(e),"float"===i?i="cssFloat":(e=this.jsvalue(e),i=this.jsproperty(i)),t.style[i]=e}),get:function(t,i){return i=this.jsproperty(i),this.jsvalue(t.style[i])},style:function(t,i){var e=t instanceof gui.Spirit?t.element:t;return gui.Object.each(i,function(t,i){this.set(e,t,i)},this),t},compute:function(t,i){var e=t instanceof gui.Spirit?t.element:t,n=e.ownerDocument,r=n.defaultView;return i=this._standardcase(this.jsproperty(i)),r.getComputedStyle(e,null).getPropertyValue(i)},matches:function(t,i){return t[this._matchmethod](i)},jsproperty:function(t){var i=this._vendors,e=t,n=document.documentElement;return t=String(t),t.startsWith("-beta-")?i.every(function(i){var r=this._camelcase(t.replace("-beta-",i));return void 0!==n.style[r]?(e=r,!1):!0},this):e=this._camelcase(e),e},jsvalue:function(t){var i=this._vendors,e=document.documentElement;if(t=String(t),t&&t.contains("-beta-")){var n=[];t.split(", ").forEach(function(t){(t=t.trim()).startsWith("-beta-")?i.every(function(i){var r=this._camelcase(t.replace("-beta-",i));return void 0!==e.style[r]?(n.push(t.replace("-beta-",i)),!1):!0},this):n.push(t)},this),t=n.join(",")}return t},cssproperty:function(t){return this._standardcase(this.jsproperty(t))},cssvalue:function(t){return this._standardcase(this.jsvalue(t))},_vendors:["","-webkit-","-moz-","-ms-","-o-"],_supports:void 0!==document.documentElement.classList,_camelcase:function(t){return t.replace(/-([a-z])/gi,function(t,i){return i.toUpperCase()})},_standardcase:function(t){return t.replace(/[A-Z]/g,function(i,e){return"-"+t.charAt(e).toLowerCase()})},_shorthands:{top:"@px",right:"@px",bottom:"@px",left:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",textIndent:"@px",fontWeight:"@",opacity:"@",zIndex:"@",position:"@",display:"@",visibility:"@"},_matchmethod:function(){var t=null,i=document.documentElement;return["mozMatchesSelector","webkitMatchesSelector","msMatchesSelector","oMatchesSelector","matchesSelector"].every(function(e){return gui.Type.isDefined(i[e])&&(t=e),null===t}),t}()})}(gui.Combo.chained),function(){function t(t){Object.defineProperty(gui.CSSPlugin.prototype,t,{enumerable:!0,configurable:!0,get:function(){return this.spirit?parseInt(this.get(t),10):void 0},set:function(i){this.set(t,i)}})}var i=gui.CSSPlugin._shorthands;for(var e in i)i.hasOwnProperty(e)&&t(e)}(),gui.DOMPlugin=function(t,i,e){return gui.Plugin.extend({id:t(function(t){return t?(this.spirit.element.id=t,void 0):this.spirit.element.id||null}),title:t(function(t){var i=this.spirit.element;return gui.Type.isDefined(t)?(i.title=t?t:"",void 0):i.title}),html:t(function(t,i){return gui.DOMPlugin.html(this.spirit.element,t,i)}),outerHtml:t(function(t){return gui.DOMPlugin.outerHtml(this.spirit.element,t)}),text:t(function(t){return gui.DOMPlugin.text(this.spirit.element,t)}),empty:t(function(){this.html("")}),hide:t(function(){this.spirit.css.contains(gui.CLASS_HIDDEN)||(this.spirit.css.add(gui.CLASS_HIDDEN),this.spirit.visibility.off())}),show:t(function(){this.spirit.css.contains(gui.CLASS_HIDDEN)&&(this.spirit.css.remove(gui.CLASS_HIDDEN),this.spirit.visibility.on())}),tag:function(){return this.spirit.element.localName},embedded:function(){return gui.DOMPlugin.embedded(this.spirit.element)},remove:function(){var t=this.spirit.element.parentNode;t.removeChild(this.spirit.element)},clone:function(){return this.spirit.element.cloneNode(!0)},ordinal:function(){return gui.DOMPlugin.ordinal(this.spirit.element)},compare:function(t){return gui.DOMPlugin.compare(this.spirit.element,t)}},{},{html:function(t,n,r){return gui.Type.isString(n)?(r?t.insertAdjacentHTML(r,n):this._shouldhandle(t)?(i.materializeSub(t),e.suspend(t,function(){t.innerHTML=n}),i.spiritualizeSub(t)):t.innerHTML=n,void 0):t.innerHTML},outerHtml:function(t,i){var n=gui.Guide;return gui.Type.isString(i)?(this._shouldhandle(t)?(n.materialize(t),e.suspend(t,function(){t.outerHTML=i}),n.spiritualize(t)):t.outerHTML=i,void 0):t.outerHTML},text:function(t,i){var n=gui.Guide;return gui.Type.isString(i)?(this._shouldhandle(t)?(n.materializeSub(t),e.suspend(t,function(){t.textContent=i})):t.textContent=i,void 0):t.textContent},ordinal:function(t){var i=0,e=t.parentNode;if(e)for(var n=e.firstElementChild;n&&n!==t;)n=n.nextElementSibling,i++;return i},compare:function(t,i){return t=t instanceof gui.Spirit?t.element:t,i=i instanceof gui.Spirit?i.element:i,t.compareDocumentPosition(i)},contains:function(t,i){var e=Node.DOCUMENT_POSITION_CONTAINS+Node.DOCUMENT_POSITION_PRECEDING;return this.compare(i,t)===e},follows:function(t,i){return this.compare(i,t)===Node.DOCUMENT_POSITION_FOLLOWING},precedes:function(t,i){return this.compare(i,t)===Node.DOCUMENT_POSITION_PRECEDING},embedded:function(t){return t=t instanceof gui.Spirit?t.element:t,this.contains(t.ownerDocument,t)},group:function(t){function i(t,i){return i.some(function(i){return gui.DOMPlugin.contains(i,t)})}for(var e,n=[];e=t.pop();)i(e,t)||n.push(e);return n},q:function(t,i,e){var n=null;return this._qualify(t,i)(function(t,i){if(e)n=this.qall(t,i,e)[0]||null;else try{n=t.querySelector(i)}catch(r){throw console.error("Dysfunctional selector: "+i),r}return n})},qall:function(t,i,e){var n=[];return this._qualify(t,i)(function(t,i){return n=gui.Array.from(t.querySelectorAll(i)),e&&(n=n.filter(function(t){return t.spirit&&t.spirit instanceof e}).map(function(t){return t.spirit})),n})},_qualify:function(t,i){var e,n=!0,r=this._thiskeyword;return t.nodeType===Node.ELEMENT_NODE&&r.test(i)&&(n=t.id,e=t.id=t.id||gui.KeyMaster.generateKey(),i=i.replace(r,"#"+e),t=t.ownerDocument),function(e){var r=e.call(gui.DOMPlugin,t,i);return n||(t.id=""),r}},_shouldhandle:function(t){var i=t.ownerDocument,e=i.defaultView;return e.gui.mode===gui.MODE_NATIVE},_thiskeyword:/^this|,this/g})}(gui.Combo.chained,gui.Guide,gui.Observer),gui.Object.bindall(gui.DOMPlugin),gui.DOMPlugin.mixin(gui.Object.map({q:function(t,i){return gui.DOMPlugin.q(this.spirit.element,t,i)},qall:function(t,i){return gui.DOMPlugin.qall(this.spirit.element,t,i)},qdoc:function(){var t=this.spirit.document.documentElement;return t.spirit.dom.q.apply(t.spirit.dom,arguments)},qdocall:function(){var t=this.spirit.document.documentElement;return t.spirit.dom.qall.apply(t.spirit.dom,arguments)}},function(t,i){return function(){var e=arguments[0],n=arguments[1];if(gui.Type.isString(e)){if(1===arguments.length||gui.Type.isFunction(n))return i.apply(this,arguments);throw n=gui.Type.of(n),new TypeError("Unknown spirit for query: "+t+"("+e+","+n+")")}throw new TypeError("Bad selector for query: "+t+"("+e+")")}})),gui.DOMPlugin.mixin(gui.Object.map({next:function(t){var i=null,e=null,n=this.spirit.element;if(t){for(;null!==(n=n.nextElementSibling);)if(e=n.spirit,null!==e&&e instanceof t){i=e;break}}else i=n.nextElementSibling;return i},previous:function(t){var i=null,e=null,n=this.spirit.element;if(t){for(;null!==(n=n.previousElementSibling);)if(e=n.spirit,null!==e&&e instanceof t){i=e;break}}else i=n.previousElementSibling;return i},first:function(t){var i=null,e=null,n=this.spirit.element.firstElementChild;if(t)for(;null===i&&null!==n;)e=n.spirit,null!==e&&e instanceof t&&(i=e),n=n.nextElementSibling;else i=n;return i},last:function(t){var i=null,e=null,n=this.spirit.element.lastElementChild;if(t)for(;null===i&&null!==n;)e=n.spirit,null!==e&&e instanceof t&&(i=e),n=n.previoustElementSibling;else i=n;return i},parent:function(t){var i=this.spirit.element.parentNode;if(t){var e=i.spirit;i=e&&e instanceof t?e:null}return i},child:function(t){var i=this.spirit.element.firstElementChild;return t&&(i=this.children(t)[0]||null),i},children:function(t){var i=gui.Array.from(this.spirit.element.children);return t&&(i=i.filter(function(i){return i.spirit&&i.spirit instanceof t}).map(function(t){return t.spirit})),i},ancestor:function(t){var i=this.parent();return t&&(i=null,(new gui.Crawler).ascend(this.spirit.element,{handleSpirit:function(e){return e instanceof t?(i=e,gui.Crawler.STOP):void 0}})),i},ancestors:function(t){var i=[],e=new gui.Crawler;return t?e.ascend(this.element,{handleSpirit:function(e){e instanceof t&&i.push(e)}}):e.ascend(this.element,{handleElement:function(t){i.push(t)}}),i},descendant:function(t){var i=this.child(),e=this.spirit.element;return t&&(new gui.Crawler).descend(e,{handleSpirit:function(n){return n instanceof t&&n.element!==e?(i=n,gui.Crawler.STOP):void 0}}),i},descendants:function(t){var i=[],e=this.spirit.element;return(new gui.Crawler).descend(e,{handleElement:function(n){t||n===e||i.push(n)},handleSpirit:function(n){t&&n instanceof t&&n.element!==e&&i.push(n)}}),i},following:function(t){for(var i,e=[],n=this.spirit.element;n=n.nextElementSibling;)t&&(i=n.spirit)?i instanceof t&&e.push(i):e.push(n);return e},preceding:function(t){for(var i,e=[],n=this.spirit.element;n=n.previousElementSibling;)t&&(i=n.spirit)?i instanceof t&&e.push(i):e.push(n);return e}},function(t,i){return function(e){if(!gui.Type.isDefined(e)||gui.Type.isFunction(e))return i.apply(this,arguments);throw new TypeError("Unknown spirit for query: "+t+"("+gui.Type.of(e)+")")}})),gui.DOMPlugin.mixin(gui.Object.map({append:function(t){var i=t,e=this.spirit.element;i.forEach(function(t){e.appendChild(t)})},prepend:function(t){var i=t,e=this.spirit.element,n=e.firstChild;i.reverse().forEach(function(t){e.insertBefore(t,n)})},before:function(t){var i=t,e=this.spirit.element,n=e.parentNode;i.reverse().forEach(function(t){n.insertBefore(t,e)})},after:function(t){var i=t,e=this.spirit.element,n=e.parentNode;i.forEach(function(t){n.insertBefore(t,e.nextSibling)})},replace:function(t){this.after(t),this.remove()}},function(t,i){return function(t){var e=Array.map(gui.Array.make(t),function(t){return t&&t instanceof gui.Spirit?t.element:t}).filter(function(t){return t&&gui.Type.isNumber(t.nodeType)});return e.length&&i.call(this,e),t}})),gui.EventPlugin=function(t){return gui.Tracker.extend({add:t(function(t,i,e,n){if(i=i?i:this.spirit.element,e=e?e:this.spirit,n=n?n:!1,i instanceof gui.Spirit&&(i=i.element),gui.Interface.validate(gui.IEventHandler,e)){var r=[i,e,n];gui.Array.make(t).forEach(function(t){this._addchecks(t,r)&&i.addEventListener(t,e,n)},this)}}),remove:t(function(t,i,e,n){if(i=i?i:this.spirit.element,e=e?e:this.spirit,n=n?n:!1,i instanceof gui.Spirit&&(i=i.element),gui.Interface.validate(gui.IEventHandler,e)){var r=[i,e,n];gui.Array.make(t).forEach(function(t){this._removechecks(t,r)&&i.removeEventListener(t,e,n)},this)}}),toggle:t(function(t,i,e,n){i=i?i:this.spirit.element,e=e?e:this.spirit,n=n?n:!1,i instanceof gui.Spirit&&(i=i.element);var r=[i,e,n];gui.Array.make(t).forEach(function(t){this._contains(t,r)?this.add(t,i,e,n):this.remove(t,i,e,n)},this)}),_cleanup:function(t,i){var e=i[0],n=i[1],r=i[2];this.remove(t,e,n,r)},_breakdown:function(t){return this._super._breakdown(t).map(function(t){return"transitionend"===t?this._transitionend():t},this)},_transitionend:function(){var t,i=this.spirit.document.createElement("fakeelement"),e={transition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in e)if(void 0!==i.style[t])return e[t]}})}(gui.Combo.chained),gui.IEventHandler={toString:function(){return"[object IEventHandler]"},handleEvent:function(){},onevent:function(){}},gui.SpritePlugin=gui.Plugin.extend({x:{getter:function(){return this._pos.x},setter:function(t){this._pos.x=t,this._apply()}},y:{getter:function(){return this._pos.y},setter:function(t){this._pos.y=t,this._apply()}},z:{getter:function(){return this._pos.z},setter:function(t){this._pos.z=t,this._apply()}},onconstruct:function(){this._super.onconstruct(),this._pos=new gui.Position},reset:function(){this.spirit.css.set("-beta-transform","")},_pos:null,_apply:function(){var t=this._pos,i=[t.x,t.y,t.z].map(Math.round);this.spirit.css.set("-beta-transform","translate3d("+i.join("px,")+"px)")}}),gui.DocumentSpirit=gui.Spirit.extend({onconstruct:function(){this._super.onconstruct(),this._dimension=new gui.Dimension,this.event.add("click mousedown mouseup"),this.event.add("load message hashchange",this.window),t===top&&this.event.add("resize orientationchange",t)},onready:function(){this._super.onready(),(this.waiting=this.window.gui.hosted)&&this.action.addGlobal(gui.$ACTION_XFRAME_VISIBILITY),this.action.dispatchGlobal(gui.ACTION_DOC_ONSPIRITUALIZED),"complete"!==this.document.readyState||this._loaded||this.onload()},onevent:function(t){try{this._super.onevent(t),this._onevent(t)}catch(i){throw i}},onaction:function(t){switch(this._super.onaction(t),this.action.$handleownaction=!1,t.type){case gui.$ACTION_XFRAME_VISIBILITY:this._waiting=!1,t.data===!0?this.visibility.on():this.visibility.off(),t.consume(),this.window.gui.hasModule("flex")&&this.flex.reflex()}},oncrawler:function(t){var i=this._super.oncrawler(t);if(i===gui.Crawler.CONTINUE)switch(t.type){case gui.CRAWLER_VISIBLE:case gui.CRAWLER_INVISIBLE:this._waiting&&(i=gui.Crawler.STOP)}return i},onvisible:function(){this.css.remove(gui.CLASS_INVISIBLE),this._super.onvisible()},oninvisible:function(){this.css.add(gui.CLASS_INVISIBLE),this._super.onvisible()},ondom:function(){this.action.dispatchGlobal(gui.ACTION_DOC_ONDOMCONTENT,this.window.location.href)},onload:function(){this._loaded?console.warn("@TODO loaded twice..."):(this._loaded=!0,this.action.dispatchGlobal(gui.ACTION_DOC_ONLOAD,this.window.location.href))},onunload:function(){var t=this.window.gui.$contextid;this.action.dispatchGlobal(gui.ACTION_DOC_UNLOAD,this.window.location.href),this.broadcast.dispatchGlobal(gui.BROADCAST_WILL_UNLOAD,t),this.broadcast.dispatchGlobal(gui.BROADCAST_UNLOAD,t)},propagateBroadcast:function(t){var i,e=t.$contextids;e.push(this.window.gui.$contextid);var n=this.dom.qall("iframe",gui.IframeSpirit).filter(function(t){return i=t.$instanceid,e.indexOf(i)>-1?!1:(e.push(i),!0)}),r=gui.Broadcast.stringify(t);n.forEach(function(t){t.postMessage(r)}),this.window.gui.hosted&&this.window.parent.postMessage(r,"*")},_loaded:!1,_waiting:!1,_dimension:null,_timeout:null,_onevent:function(t){switch(t.type){case"click":case"mousedown":case"mouseup":case"pointerdown":case"pointerup":this._broadcastevent(t);break;case"orientationchange":this._onorientationchange();break;case"resize":this._onresize();break;case"load":t.stopPropagation();break;case"message":this._onmessage(t.data,t.origin,t.source);break;case"hashchange":this.action.dispatchGlobal(gui.ACTION_DOC_ONHASH,this.document.location.hash)}},_broadcastevent:function(t){gui.broadcastGlobal({click:gui.BROADCAST_MOUSECLICK,mousedown:gui.BROADCAST_MOUSEDOWN,mouseup:gui.BROADCAST_MOUSEUP}[t.type],t)},_onmessage:function(t,i,e){var n="spiritual-broadcast";if(t.startsWith(n)){var r=gui.Broadcast.parse(t);this._relaybroadcast(r.$contextids,i,e)&&gui.Broadcast.$dispatch(r)}else if(e===this.window.parent&&(n="spiritual-action",t.startsWith(n))){var s=gui.Action.parse(t);s.direction===gui.Action.DESCEND&&(this.action.$handleownaction=!0,this.action.descendGlobal(s.type,s.data))}},_relaybroadcast:function(t,i){var e=[gui.$contextid,this.window.gui.$contextid];return i===this.window.gui.xhost||e.every(function(i){return t.indexOf(i)<0})},_onresize:function(){this.window.clearTimeout(this._timeout),this._timeout=this.window.setTimeout(function(){gui.broadcastGlobal(gui.BROADCAST_RESIZE_END)},gui.TIMEOUT_RESIZE_END)},_onorientationchange:function(){gui.orientation=t.innerWidth>t.innerHeight?1:0,gui.broadcastGlobal(gui.BROADCAST_ORIENTATIONCHANGE)}}),gui.IframeSpirit=gui.Spirit.extend({spiritualized:!1,cover:!1,fit:!1,xguest:null,contentWindow:{getter:function(){return this.element?this.element.contentWindow:null},setter:function(){}},contentDocument:{getter:function(){return this.element?this.element.contentDocument:null},setter:function(){}},contentLocation:null,onconstruct:function(){this._super.onconstruct(),this.event.add("message",this.window,this),this._postbox=[]
},onenter:function(){this._super.onenter(),this.action.addGlobal([gui.ACTION_DOC_ONDOMCONTENT,gui.ACTION_DOC_ONLOAD,gui.ACTION_DOC_ONHASH,gui.ACTION_DOC_ONSPIRITUALIZED,gui.ACTION_DOC_UNLOAD]),this.fit&&(this.css.height=0),this.cover&&this._coverup();var t=this.element.src;t&&t!==gui.IframeSpirit.SRC_DEFAULT&&this.src(t)},onaction:function(t){switch(this._super.onaction(t),this.action.$handleownaction=!1,t.type){case gui.ACTION_DOC_ONDOMCONTENT:this.life.dispatch(gui.LIFE_IFRAME_DOMCONTENT),this.action.remove(t.type),t.consume();break;case gui.ACTION_DOC_ONLOAD:this.life.dispatch(gui.LIFE_IFRAME_ONLOAD),this.action.remove(t.type),t.consume();break;case gui.ACTION_DOC_ONHASH:var i=this.contentLocation.href.split("#")[0];this.contentLocation=new gui.URL(this.document,i+t.data),this.life.dispatch(gui.LIFE_IFRAME_ONHASH),t.consume();break;case gui.ACTION_DOC_ONSPIRITUALIZED:this._onspiritualized(),this.life.dispatch(gui.LIFE_IFRAME_SPIRITUALIZED),this.action.remove(t.type),t.consume();break;case gui.ACTION_DOC_UNLOAD:this._onunload(),this.life.dispatch(gui.LIFE_IFRAME_UNLOAD),this.action.add([gui.ACTION_DOC_ONCONSTRUCT,gui.ACTION_DOC_ONDOMCONTENT,gui.ACTION_DOC_ONLOAD,gui.ACTION_DOC_ONSPIRITUALIZED]),t.consume()}},onevent:function(t){this._super.onevent(t),"message"===t.type&&this._onmessage(t.data,t.origin,t.source)},onvisible:function(){this._super.onvisible(),this.spiritualized&&this._visibility()},oninvisible:function(){this._super.oninvisible(),this.spiritualized&&this._visibility()},src:function(t){return t&&(this._setupsrc(t),this.element.src=t),this.element.src},url:function(t,i){return i&&this._setupsrc(i),t&&(this.element.src=t),this.element.src},postMessage:function(t){this.spiritualized?this.contentWindow.postMessage(t,"*"):this._postbox.push(t)},_cover:null,_setupsrc:function(t){var i=this.document;this.contentLocation=new gui.URL(i,t),this.xguest=function(e){if(e)return"*";if(gui.URL.external(t,i)){var n=new gui.URL(i,t);return n.protocol+"//"+n.host}return null}(this._sandboxed())},_onspiritualized:function(){for(this.spiritualized=!0;this._postbox.length;)this.postMessage(this._postbox.shift());this._visibility(),this.cover&&!this.fit&&this._coverup(!1)},_onfit:function(t){this.fit&&(this.css.height=t,this.action.dispatchGlobal(gui.ACTION_DOC_FIT)),this.cover&&this._coverup(!1)},_onunload:function(){this.spiritualized=!1,this.fit&&(this.css.height=0),this.cover&&this._coverup(!0)},_onmessage:function(t,i,e){if(e===this.contentWindow&&t.startsWith("spiritual-action:")){var n=gui.Action.parse(t);n.direction===gui.Action.ASCEND&&(this.action.$handleownaction=!0,this.action.ascendGlobal(n.type,n.data))}},_sandboxed:function(){return this.element.sandbox.length},_visibility:function(){gui.Type.isDefined(this.life.visible)&&this.action.descendGlobal(gui.$ACTION_XFRAME_VISIBILITY,this.life.visible)},_coverup:function(t){var i=this.box;this._cover=this._cover||this.dom.after(gui.CoverSpirit.summon(this.document)),t?(this._cover.position(new gui.Geometry(i.localX,i.localY,i.width,i.height)),this._cover.dom.show()):this._cover.dom.hide()}},{summon:function(t,i){var e=t.createElement("iframe"),n=this.possess(e);if(n.css.add("gui-iframe"),i){if(gui.URL.external(i,t)){var r=new gui.URL(t,i);n.xguest=r.protocol+"//"+r.host}}else i=this.SRC_DEFAULT;return e.src=i,n}},{SRC_DEFAULT:"javascript:void(false);"}),gui.StyleSheetSpirit=gui.Spirit.extend({onenter:function(){this._super.onenter(),this._rules&&(this.addRules(this._rules),this._rules=null)},disable:function(){this.element.disabled=!0},enable:function(){this.element.disabled=!1},addRules:function(t){var i=this.element.sheet,e=i.cssRules.length;gui.Object.each(t,function(t,n){i.insertRule(t+this._ruleout(n),e++)},this)},_rules:null,_ruleout:function(t){var i="",e=gui.CSSPlugin;return gui.Object.each(t,function(t,n){i+=e.cssproperty(t)+":"+e.cssvalue(n)+";"}),"{"+i+"}"}},{summon:function(t,i,e,n){var r=i?this._createlink(t,i):this._createstyle(t),s=this.possess(r);return e&&(i?r.addEventListener("load",function(){s.addRules(e)},!1):s._rules=e),n&&s.disable(),s},_createlink:function(t,i){var e=t.createElement("link");return e.className="gui-stylesheet",e.rel="stylesheet",e.href=i,e},_createstyle:function(t){var i=t.createElement("style");return i.className="gui-stylesheet",i.appendChild(t.createTextNode("")),i}}),gui.CoverSpirit=gui.Spirit.extend({show:function(){return this.dom.show(),this},hide:function(){return this.dom.hide(),this},position:function(t){this.css.style({top:t.y,left:t.x,width:t.w,height:t.h})},fadeIn:function(t){gui.Client.hasTransitions?(this.transition.none(),this.css.opacity=0,this.show(),this.transition.run({duration:t||250,property:"opacity",opacity:1})):this.show()},fadeOut:function(t){gui.Client.hasTransitions?(this.transition.none(),this.css.opacity=1,this.show(),this.transition.run({duration:t||250,property:"opacity",opacity:0}).then(function(){this.hide()},this)):this.hide()}},{summon:function(t,i){var e=this.possess(t.createElement("div"));return e.css.add(gui.CLASS_COVER),i&&e.position(i),e}}),gui.module("spirits",{channels:[["html",gui.DocumentSpirit],[".gui-styles",gui.StyleSheetSpirit],[".gui-iframe",gui.IframeSpirit],[".gui-cover",gui.CoverSpirit],[".gui-spirit",gui.Spirit]],plugins:{att:gui.AttPlugin,attconfig:gui.AttConfigPlugin,box:gui.BoxPlugin,css:gui.CSSPlugin,dom:gui.DOMPlugin,event:gui.EventPlugin,life:gui.LifePlugin,sprite:gui.SpritePlugin},mixins:{onatt:function(){},onevent:function(){},onlife:function(){},handleEvent:function(t){"webkitTransitionEnd"===t.type&&(t={type:"transitionend",target:t.target,propertyName:t.propertyName,elapsedTime:t.elapsedTime,pseudoElement:t.pseudoElement}),this.onevent(t)},$ondestruct:gui.Combo.before(function(){this.handleEvent=function(){}})(gui.Spirit.prototype.$ondestruct)}})}(this);