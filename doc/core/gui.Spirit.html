<!DOCTYPE html><html lang="en"><head><title>core/gui.Spirit</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="core/gui.Spirit"><meta name="groc-project-path" content="src/core/gui.Spirit.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/core/gui.Spirit.js</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h1 id="guispirit">gui.Spirit</h1>

<p>Base constructor for all spirits</p></div></div><div class="code"><div class="wrapper"><span class="nx">gui</span><span class="p">.</span><span class="nx">Spirit</span> <span class="o">=</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">Exemplar</span><span class="p">.</span><span class="nx">create</span> <span class="p">(</span> <span class="s2">&quot;gui.Spirit&quot;</span><span class="p">,</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Spirit DOM element.
@type {Element} </p></div></div><div class="code"><div class="wrapper">  <span class="nx">element</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Containing document.
@type {Document}</p></div></div><div class="code"><div class="wrapper">  <span class="nb">document</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Containing window.
@type {Window} </p></div></div><div class="code"><div class="wrapper">  <span class="nb">window</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Unique key for this spirit instance.
@type {String}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">spiritkey</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Matches the property "signature" of the {gui.Spiritual} 
instance in local window context (the gui object). This 
will come in handy when Spiritual is running in iframes.
@todo rename "guikey"?
@type {String}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">signature</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="basics">Basics</h3></div></div><div class="code"><div class="wrapper">  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Identification.
@returns {String}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">toString</span> <span class="o">:</span> <span class="kd">function</span> <span class="nx">toString</span> <span class="p">()</span> <span class="p">{</span>   
    <span class="k">return</span> <span class="s2">&quot;[object gui.Spirit]&quot;</span><span class="p">;</span>
  <span class="p">},</span>
  
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="lifecycle">Lifecycle</h3></div></div><div class="code"><div class="wrapper">  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p><em>You can safely overload or overwrite methods in the lifecycle section, 
but you should leave it to the {gui.Guide} to invoke them. Also, do make 
sure to always call this._super.themethod () unless you really mean it.</em></p></div></div><div class="code"><div class="wrapper">  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Invoked when spirit is newed up. Spirit element may <br />
not be positioned in the document DOM at this point. </p></div></div><div class="code"><div class="wrapper">  <span class="nx">onconstruct</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">__plugin__</span> <span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">__debug__</span> <span class="p">(</span> <span class="kc">true</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">goconstruct</span> <span class="p">();</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>@todo Comments go here.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">onconfigure</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">configure</span> <span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">goconfigure</span> <span class="p">();</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Spirit first encounted as a node in the page DOM. This is only called once 
in the lifecycle of a spirit (unlike attach, see below).</p></div></div><div class="code"><div class="wrapper">  <span class="nx">onenter</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">gui</span><span class="p">.</span><span class="nx">inside</span> <span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">goenter</span> <span class="p">();</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Invoked 
* whenever spirit element is attached to the DOM tree
* when the element is in the DOM on page load and the spirit is first discovered by the framework
@todo Check if spirit matchesselector gui.CLASS_INVISIBLE + " *"</p></div></div><div class="code"><div class="wrapper">  <span class="nx">onattach</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">gui</span><span class="p">.</span><span class="nx">inside</span> <span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">goattach</span> <span class="p">();</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Invoked (only once) when all descendant spirits are attached and ready. 
From a DOM tree perspective, this fires in reverse order, innermost first. </p></div></div><div class="code"><div class="wrapper">  <span class="nx">onready</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">goready</span> <span class="p">();</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Hello!</p></div></div><div class="code"><div class="wrapper">  <span class="nx">onvisible</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">govisible</span> <span class="p">();</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Hello.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">oninvisible</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">goinvisible</span> <span class="p">();</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Invoked whenever spirit element is detached from the DOM tree. </p></div></div><div class="code"><div class="wrapper">  <span class="nx">ondetach</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">gui</span><span class="p">.</span><span class="nx">outside</span> <span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">godetach</span> <span class="p">();</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Invoked when spirit is detached and not re-attached in the same thread. 
This triggers destruction <em>unless</em> you return false. In this case, make sure 
to manually dispose the spirit later (using method <code>dispose</code>). <br />
@returns {boolean} Optionally return false to manage your own destruction</p></div></div><div class="code"><div class="wrapper">  <span class="nx">onexit</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">goexit</span> <span class="p">();</span> <span class="c1">// do not call _super.onexit if you return false</span>
    <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Invoked when spirit gets disposed. Code your last wishes.
Should only be called by the framework, use <code>dispose()</code>.
@see {gui.Spirit#dispose}
@param {boolean} unloading
@returns {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">ondestruct</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">unloading</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">gui</span><span class="p">.</span><span class="nx">destruct</span> <span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">godestruct</span> <span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">__debug__</span> <span class="p">(</span> <span class="kc">false</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">__destruct__</span> <span class="p">(</span> <span class="nx">unloading</span> <span class="p">);</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="handlers">Handlers</h3></div></div></div><div class="segment"><div class="code"><div class="wrapper">  <span class="cm">/* ............................................................................. */</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Handle crawler.
@param {gui.Crawler} crawler
@returns {number}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">oncrawler</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">crawler</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">Crawler</span><span class="p">.</span><span class="nx">CONTINUE</span><span class="p">;</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Handle lifecycle event.
@param {gui.SpiritLife} life</p></div></div><div class="code"><div class="wrapper">  <span class="nx">onlife</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">life</span> <span class="p">)</span> <span class="p">{},</span>
  
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="specials">Specials</h3></div></div><div class="code"><div class="wrapper">  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Hello.
@returns {gui.Spirit}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">visible</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">Spirit</span><span class="p">.</span><span class="nx">visible</span> <span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Hello.
@returns {gui.Spirit}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">invisible</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">Spirit</span><span class="p">.</span><span class="nx">invisible</span> <span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>@todo boolean trap in this API
Terminate the spirit and remove the element (optionally keep it). 
@param {boolean} keep True to leave the element on stage.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">dispose</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">keep</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">keep</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">dom</span><span class="p">.</span><span class="nx">remove</span> <span class="p">();</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ondestruct</span> <span class="p">();</span>
  <span class="p">},</span>
  
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="secrets">Secrets</h3></div></div></div><div class="segment"><div class="code"><div class="wrapper">  <span class="cm">/* ............................................................................. */</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Secret constructor.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">__construct__</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Experimental.
@type {[type]}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">__lazies__</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Instantiate plugins.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">__plugin__</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>core plugins first</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">life</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLifeTracker</span> <span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritConfig</span> <span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">__lazies__</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span> <span class="p">(</span> <span class="kc">null</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>bonus plugins second</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">prefixes</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">plugins</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">__plugins__</span><span class="p">;</span>
    <span class="nx">gui</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">each</span> <span class="p">(</span> <span class="nx">plugins</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">prefix</span><span class="p">,</span> <span class="nx">Plugin</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">switch</span> <span class="p">(</span> <span class="nx">Plugin</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLifeTracker</span> <span class="o">:</span>
        <span class="k">case</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritConfig</span> <span class="o">:</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span> <span class="o">:</span>
          <span class="k">if</span> <span class="p">(</span> <span class="nx">Plugin</span><span class="p">.</span><span class="nx">lazy</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritPlugin</span><span class="p">.</span><span class="nx">later</span> <span class="p">(</span> <span class="nx">Plugin</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">__lazies__</span> <span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span> <span class="p">[</span> <span class="nx">prefix</span> <span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Plugin</span> <span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">prefixes</span><span class="p">.</span><span class="nx">push</span> <span class="p">(</span> <span class="nx">prefix</span> <span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="k">this</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>construct plugins in that order</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">onconstruct</span> <span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">onconstruct</span> <span class="p">();</span>
    <span class="nx">prefixes</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">prefix</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">__lazies__</span> <span class="p">[</span> <span class="nx">prefix</span> <span class="p">])</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>lazy plugins constructed when addressed</p></div></div><div class="code"><div class="wrapper">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span> <span class="p">[</span> <span class="nx">prefix</span> <span class="p">].</span><span class="nx">onconstruct</span> <span class="p">();</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="k">this</span> <span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>In debug mode, stamp the toString value onto the spirit element. 
The toString value is defined bt the string that may be passed as 
first argument to the gui.Spirit.infuse("JohnsonSpirit") method. 
Debug mode is set per document via local script: ui.debug=true;
@param {boolean} constructing</p></div></div><div class="code"><div class="wrapper">  <span class="nx">__debug__</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">constructing</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">val</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">gui</span><span class="p">.</span><span class="nx">debug</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">constructing</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">att</span><span class="p">.</span><span class="nx">has</span> <span class="p">(</span> <span class="s2">&quot;gui&quot;</span> <span class="p">))</span> <span class="p">{</span>
          <span class="nx">val</span> <span class="o">=</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">displayName</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">att</span><span class="p">.</span><span class="nx">set</span> <span class="p">(</span> <span class="s2">&quot;gui&quot;</span><span class="p">,</span> <span class="nx">val</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">val</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">att</span><span class="p">.</span><span class="nx">get</span> <span class="p">(</span> <span class="s2">&quot;gui&quot;</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">val</span> <span class="o">&amp;&amp;</span> <span class="nx">val</span><span class="p">.</span><span class="nx">startsWith</span> <span class="p">(</span> <span class="s2">&quot;[&quot;</span> <span class="p">))</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">att</span><span class="p">.</span><span class="nx">del</span> <span class="p">(</span> <span class="s2">&quot;gui&quot;</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Total destruction.
@param @optional {boolean} unloading If true, destruct immediately</p></div></div><div class="code"><div class="wrapper">  <span class="nx">__destruct__</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">unloading</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__lazies__</span><span class="p">;</span>
    <span class="nx">gui</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">each</span> <span class="p">(</span> <span class="nx">map</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">prefix</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">map</span> <span class="p">[</span> <span class="nx">prefix</span> <span class="p">]</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">delete</span> <span class="k">this</span> <span class="p">[</span> <span class="nx">prefix</span> <span class="p">];</span> <span class="c1">// otherwise next iterator will instantiate the lazy plugin...</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="k">this</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>dispose plugins (plugins should not invoke external stuff during this phase)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">gui</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">each</span> <span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">prop</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">thing</span> <span class="o">=</span> <span class="k">this</span> <span class="p">[</span> <span class="nx">prop</span> <span class="p">];</span>
      <span class="k">switch</span> <span class="p">(</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">of</span> <span class="p">(</span> <span class="nx">thing</span> <span class="p">))</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s2">&quot;object&quot;</span> <span class="o">:</span>
          <span class="k">if</span> <span class="p">(</span> <span class="nx">thing</span> <span class="k">instanceof</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritPlugin</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nx">thing</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">life</span> <span class="p">)</span> <span class="p">{</span>
              <span class="nx">thing</span><span class="p">.</span><span class="nx">__destruct__</span> <span class="p">(</span> <span class="nx">unloading</span> <span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="k">this</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>dispose life plugin last...</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">__destruct__</span> <span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>schedule cremation?</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="nx">unloading</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">__null__</span> <span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">tick</span> <span class="o">=</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">TICK_SPIRIT_NULL</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">spirit</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
      <span class="nx">gui</span><span class="p">.</span><span class="nx">Tick</span><span class="p">.</span><span class="nx">one</span> <span class="p">(</span> <span class="nx">tick</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">ontick</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="k">try</span> <span class="p">{</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">__null__</span> <span class="p">();</span>
          <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">exception</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>@todo why sometimes gui.Spirit.DENIED?</p></div></div><div class="code"><div class="wrapper">          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">signature</span> <span class="p">).</span><span class="nx">dispatch</span> <span class="p">(</span> <span class="nx">tick</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">signature</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Null all props. We have hotfixed conflicts upon disposal by moving this to a new 
execution stack, but the consequences should be thought throught at some point. </p></div></div><div class="code"><div class="wrapper">  <span class="nx">__null__</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">element</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">spirit</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">denied</span> <span class="p">)</span> <span class="p">{</span> <span class="cm">/* explorer may deny permission in frames */</span> <span class="p">}</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>null all properties</p></div></div><div class="code"><div class="wrapper">    <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span> <span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">forEach</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">prop</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span> <span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">Spirit</span><span class="p">.</span><span class="nx">DENIED</span> <span class="p">);</span>
    <span class="p">},</span> <span class="k">this</span> <span class="p">);</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="recurring-statics">Recurring statics</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="p">},</span> <span class="p">{</span> <span class="cm">/* ............................................................................. */</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Mapping plugin constructor to prefix.
@type {Map<String,function>}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">__plugins__</span> <span class="o">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span> <span class="p">(</span> <span class="kc">null</span> <span class="p">),</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Portal this spirit to descendant iframes?
@see {ui#portal} <br />
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">portals</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Extends spirit and plugins (mutating plugins) plus update getters/setters.
@param {object} expando 
@param {object} recurring 
@param {object} statics 
@returns {gui.Spirit}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">infuse</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">C</span> <span class="o">=</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">Exemplar</span><span class="p">.</span><span class="nx">extend</span><span class="p">.</span><span class="nx">apply</span> <span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>
    <span class="nx">C</span><span class="p">.</span><span class="nx">__plugins__</span> <span class="o">=</span> <span class="nx">gui</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">copy</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">__plugins__</span> <span class="p">);</span>
    <span class="kd">var</span> <span class="nx">breakdown</span> <span class="o">=</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">Exemplar</span><span class="p">.</span><span class="nx">breakdown</span> <span class="p">(</span> <span class="nx">arguments</span> <span class="p">);</span>
    <span class="nx">gui</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">each</span> <span class="p">(</span> <span class="nx">C</span><span class="p">.</span><span class="nx">__plugins__</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">prefix</span><span class="p">,</span> <span class="nx">plugin</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">def</span> <span class="o">=</span> <span class="nx">breakdown</span><span class="p">.</span><span class="nx">expando</span> <span class="p">[</span> <span class="nx">prefix</span> <span class="p">];</span>     
      <span class="k">switch</span> <span class="p">(</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">of</span> <span class="p">(</span> <span class="nx">def</span> <span class="p">))</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s2">&quot;object&quot;</span> <span class="o">:</span>
          <span class="kd">var</span> <span class="nx">mutant</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">extend</span> <span class="p">(</span> <span class="nx">def</span> <span class="p">);</span>
          <span class="nx">C</span><span class="p">.</span><span class="nx">plugin</span> <span class="p">(</span> <span class="nx">prefix</span><span class="p">,</span> <span class="nx">mutant</span><span class="p">,</span> <span class="kc">true</span> <span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">:</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span> <span class="o">:</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span> <span class="p">(</span> <span class="nx">C</span> <span class="o">+</span> <span class="s2">&quot;: Bad definition: &quot;</span> <span class="o">+</span> <span class="nx">prefix</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="k">this</span> <span class="p">);</span>
    <span class="k">return</span> <span class="nx">C</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Subclassing a spirit allows you to also subclass it's plugins 
using the same declarative syntax. To avoid potential frustration, 
we throw on the <code>extend</code> method which doesn't offfer this feature.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">extend</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="p">(</span> 
      <span class="s1">&#39;Spirits must use the &quot;infuse&quot; method and not &quot;extend&quot;.\n&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;This method extends both the spirit and it\&#39;s plugins.&#39;</span>
    <span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Create element (this will likely be removed).
@param {Document} doc
@param {String} tag</p></div></div><div class="code"><div class="wrapper">  <span class="nx">tag</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">doc</span><span class="p">,</span> <span class="nx">tag</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="p">(</span> <span class="s2">&quot;Deprecated&quot;</span> <span class="p">);</span> <span class="c1">// = spirit.lazies || Object.create ( null );</span>
    <span class="k">return</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span> <span class="p">(</span> <span class="nx">tag</span> <span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Set attribute (this will likely be removed).
@param {Element} elm
@param {String} att
@param {String} val</p></div></div><div class="code"><div class="wrapper">  <span class="nx">att</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">elm</span><span class="p">,</span> <span class="nx">att</span><span class="p">,</span> <span class="nx">val</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="p">(</span> <span class="s2">&quot;Deprecated&quot;</span> <span class="p">);</span>
    <span class="nx">elm</span><span class="p">.</span><span class="nx">setAttribute</span> <span class="p">(</span> <span class="nx">att</span><span class="p">,</span> <span class="nb">String</span> <span class="p">(</span> <span class="nx">val</span> <span class="p">));</span>
    <span class="k">return</span> <span class="nx">elm</span><span class="p">;</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Set element text (this will likely be removed).
@param {Element} elm
@param {String} txt</p></div></div><div class="code"><div class="wrapper">  <span class="nx">text</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">elm</span><span class="p">,</span> <span class="nx">txt</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="p">(</span> <span class="s2">&quot;Deprecated&quot;</span> <span class="p">);</span>
    <span class="nx">elm</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">txt</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Parse HTML string to DOM element in given document context.
@todo parent element awareness when inserted in document :)
@param {Document} doc
@param {String} html
@returns {Element}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">parse</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">doc</span><span class="p">,</span> <span class="nx">html</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">DOCUMENT_NODE</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">HTMLParser</span> <span class="p">(</span> <span class="nx">doc</span> <span class="p">).</span><span class="nx">parse</span> <span class="p">(</span> <span class="nx">html</span> <span class="p">)[</span> <span class="mi">0</span> <span class="p">];</span> <span class="c1">// @todo parseOne?</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span> <span class="p">(</span> <span class="k">this</span> <span class="o">+</span> <span class="s2">&quot;.parse() expects a Document&quot;</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Associate DOM element to Spirit instance.
@param {Element} element
@returns {Spirit}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">animate</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">element</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">Guide</span><span class="p">.</span><span class="nx">animate</span> <span class="p">(</span> <span class="nx">element</span><span class="p">,</span> <span class="k">this</span> <span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Create DOM element and associate Spirit instance.
@param @optional {Document} doc
@returns {gui.Spirit}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">summon</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">doc</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">doc</span> <span class="o">=</span> <span class="nx">doc</span> <span class="o">?</span> <span class="nx">doc</span> <span class="o">:</span> <span class="nb">document</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">animate</span> <span class="p">(</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span> <span class="p">(</span> <span class="s2">&quot;div&quot;</span> <span class="p">));</span>
  <span class="p">},</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Assign plugin to prefix, checking for naming collision.
@param {String} prefix
@param {function} plugin Constructor for plugin
@param {boolean} override Disable collision detection</p></div></div><div class="code"><div class="wrapper">  <span class="nx">plugin</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">prefix</span><span class="p">,</span> <span class="nx">plugin</span><span class="p">,</span> <span class="nx">override</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Partly prepared for a scenario where spirits 
may have been declared before plugins load.</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">plugins</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__plugins__</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span> <span class="p">(</span> <span class="nx">prefix</span> <span class="p">)</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">override</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">plugins</span> <span class="p">[</span> <span class="nx">prefix</span> <span class="p">]</span> <span class="o">||</span> <span class="nx">override</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">plugins</span> <span class="p">[</span> <span class="nx">prefix</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nx">gui</span><span class="p">.</span><span class="nx">Exemplar</span><span class="p">.</span><span class="nx">children</span> <span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">sub</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">sub</span><span class="p">.</span><span class="nx">plugin</span> <span class="p">(</span> <span class="nx">prefix</span><span class="p">,</span> <span class="nx">plugin</span><span class="p">,</span> <span class="nx">override</span> <span class="p">);</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="p">(</span> <span class="s2">&quot;Plugin naming crash in &quot;</span> <span class="o">+</span> <span class="k">this</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nx">prefix</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="cm">/*</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>@todo move to Spiritual EDB
@type {String}</p></div></div><div class="code"><div class="wrapper"><span class="cm">  script : null,</span>
<span class="cm">  </span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>@todo move to Spiritual EDB.
@param {Document} doc
@returns {String}</p></div></div><div class="code"><div class="wrapper"><span class="cm">  run : function ( doc ) {</span>

<span class="cm">    var func = edb.Function.get ( this.script, doc.defaultView );</span>
<span class="cm">    var args = Array.filter ( arguments, function ( e, i ) {</span>
<span class="cm">      return i &gt; 0;</span>
<span class="cm">    });</span>
<span class="cm">    var html = func.apply ( {}, args );</span>
<span class="cm">    return this.animate ( this.parse ( doc, html ));</span>
<span class="cm">  }</span>
<span class="cm">  */</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="statics">Statics</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="p">},</span> <span class="p">{</span> <span class="cm">/* ............................................................................. */</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Hello.
@param {gui.Spirit} spirit
@returns {gui.Spirit}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">visible</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">spirit</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">spirit</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">invisible</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_visible</span> <span class="p">(</span> <span class="nx">spirit</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">spirit</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">entered</span> <span class="p">);</span>
      <span class="nx">spirit</span><span class="p">.</span><span class="nx">css</span><span class="p">.</span><span class="nx">remove</span> <span class="p">(</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">CLASS_INVISIBLE</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">spirit</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Hello.
@param {gui.Spirit} spirit
@returns {gui.Spirit}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">invisible</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">spirit</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">spirit</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">visible</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_visible</span> <span class="p">(</span> <span class="nx">spirit</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">spirit</span><span class="p">.</span><span class="nx">life</span><span class="p">.</span><span class="nx">entered</span> <span class="p">);</span>
      <span class="nx">spirit</span><span class="p">.</span><span class="nx">css</span><span class="p">.</span><span class="nx">add</span> <span class="p">(</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">CLASS_INVISIBLE</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">spirit</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Hello again.
@param {gui.Spirit} spirit
@param {boolean} show
@param {boolean} subtree</p></div></div><div class="code"><div class="wrapper">  <span class="nx">_visible</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">spirit</span><span class="p">,</span> <span class="nx">show</span><span class="p">,</span> <span class="nx">subtree</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">crawler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">Crawler</span> <span class="p">(</span> <span class="nx">show</span> <span class="o">?</span> 
      <span class="nx">gui</span><span class="p">.</span><span class="nx">CRAWLER_VISIBLE</span> <span class="o">:</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">CRAWLER_INVISIBLE</span> 
    <span class="p">);</span>
    <span class="nx">crawler</span><span class="p">.</span><span class="nx">global</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">crawler</span><span class="p">.</span><span class="nx">descend</span> <span class="p">(</span> <span class="nx">spirit</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">handleSpirit</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">s</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">show</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">s</span><span class="p">.</span><span class="nx">onvisible</span> <span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">s</span><span class="p">.</span><span class="nx">oninvisible</span> <span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">subtree</span> <span class="o">?</span>
          <span class="nx">gui</span><span class="p">.</span><span class="nx">Crawler</span><span class="p">.</span><span class="nx">CONTINUE</span> <span class="o">:</span>
          <span class="nx">gui</span><span class="p">.</span><span class="nx">Crawler</span><span class="p">.</span><span class="nx">STOP</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>User to access property post destruction, report that the spirit was terminated. </p></div></div><div class="code"><div class="wrapper">  <span class="nx">DENIED</span> <span class="o">:</span> <span class="p">{</span>
    <span class="nx">enumerable</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">configurable</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">get</span> <span class="o">:</span> <span class="kd">function</span> <span class="nx">DENIED</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="p">(</span> <span class="s2">&quot;Attempt to handle destructed spirit&quot;</span> <span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">set</span> <span class="o">:</span> <span class="kd">function</span> <span class="nx">DENIED</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="p">(</span> <span class="s2">&quot;Attempt to handle destructed spirit&quot;</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></div></div></div></div></body></html>