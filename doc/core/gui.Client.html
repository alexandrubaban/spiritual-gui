<!DOCTYPE html><html lang="en"><head><title>core/gui.Client</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="core/gui.Client"><meta name="groc-project-path" content="src/core/gui.Client.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/core/gui.Client.js</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h1 id="guiclient">gui.Client</h1>

<p>Questionable browser identity and feature detection.
Note that Chrome on iOS identifies itself as Safari 
(it basically is, so that shouldn't cause concern).</p></div></div><div class="code"><div class="wrapper"><span class="nx">gui</span><span class="p">.</span><span class="nx">Client</span> <span class="o">=</span> <span class="k">new</span> <span class="kd">function</span> <span class="nx">Client</span> <span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Expecting a lot from the user agent string... </p></div></div><div class="code"><div class="wrapper">  <span class="kd">var</span> <span class="nx">agent</span> <span class="o">=</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">.</span><span class="nx">toLowerCase</span> <span class="p">();</span>
  <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">isExplorer</span> <span class="o">=</span> <span class="nx">agent</span><span class="p">.</span><span class="nx">contains</span> <span class="p">(</span> <span class="s2">&quot;msie&quot;</span> <span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">isOpera</span> <span class="o">=</span> <span class="nx">agent</span><span class="p">.</span><span class="nx">contains</span> <span class="p">(</span> <span class="s2">&quot;opera&quot;</span> <span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">isWebKit</span> <span class="o">=</span> <span class="nx">agent</span><span class="p">.</span><span class="nx">contains</span> <span class="p">(</span> <span class="s2">&quot;webkit&quot;</span> <span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">isChrome</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">isWebKit</span> <span class="o">&amp;&amp;</span> <span class="nx">agent</span><span class="p">.</span><span class="nx">contains</span> <span class="p">(</span> <span class="s2">&quot;chrome&quot;</span> <span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">isSafari</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">isWebKit</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isChrome</span> <span class="o">&amp;&amp;</span> <span class="nx">agent</span><span class="p">.</span><span class="nx">contains</span> <span class="p">(</span> <span class="s2">&quot;safari&quot;</span> <span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">isGecko</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isWebKit</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isOpera</span> <span class="o">&amp;&amp;</span> <span class="nx">agent</span><span class="p">.</span><span class="nx">contains</span> <span class="p">(</span> <span class="s2">&quot;gecko&quot;</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>"agent" is one of: "webkit" "firefox" "opera" "explorer"
@type {String}</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">agent</span> <span class="o">=</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">agent</span> <span class="o">=</span> <span class="s2">&quot;explorer&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">isWebKit</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">agent</span> <span class="o">=</span> <span class="s2">&quot;webkit&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">isGecko</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">agent</span> <span class="o">=</span> <span class="s2">&quot;gecko&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">isOpera</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">agent</span> <span class="o">=</span> <span class="s2">&quot;opera&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">agent</span><span class="p">;</span>
  <span class="p">}).</span><span class="nx">call</span> <span class="p">(</span> <span class="k">this</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>"system" is one of: "linux" "osx" "ios" "windows" "windowsmobile" "haiku"</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">system</span> <span class="o">=</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">os</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">[</span> <span class="s2">&quot;window mobile&quot;</span><span class="p">,</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span> <span class="s2">&quot;ipad&quot;</span><span class="p">,</span> <span class="s2">&quot;iphone&quot;</span><span class="p">,</span> <span class="s2">&quot;haiku&quot;</span><span class="p">,</span> <span class="s2">&quot;os x&quot;</span><span class="p">,</span> <span class="s2">&quot;linux&quot;</span> <span class="p">].</span><span class="nx">every</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">test</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">agent</span><span class="p">.</span><span class="nx">contains</span> <span class="p">(</span> <span class="nx">test</span> <span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">test</span><span class="p">.</span><span class="nx">match</span> <span class="p">(</span> <span class="sr">/ipad|iphone/</span> <span class="p">))</span> <span class="p">{</span>
          <span class="nx">os</span> <span class="o">=</span> <span class="s2">&quot;ios&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">os</span> <span class="o">=</span> <span class="nx">test</span><span class="p">.</span><span class="nx">replace</span> <span class="p">(</span> <span class="sr">/ /g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span> <span class="c1">// no spaces</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">os</span> <span class="o">===</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">os</span><span class="p">;</span>
  <span class="p">})();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Has touch support? Note that desktop Chrome has this.
@todo Investigate this in desktop IE10.
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">hasTouch</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">window</span><span class="p">.</span><span class="nx">ontouchstart</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">isChrome</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Supports file blob?
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">hasBlob</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Blob</span> <span class="o">&amp;&amp;</span> <span class="p">(</span> <span class="nb">window</span><span class="p">.</span><span class="nx">URL</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">webkitURL</span> <span class="p">));</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Is mobile device? Not to be confused with this.hasTouch
@todo gui.Observerice entity?
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">isMobile</span> <span class="o">=</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    
    <span class="kd">var</span> <span class="nx">shortlist</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;android&quot;</span><span class="p">,</span> <span class="s2">&quot;webos&quot;</span><span class="p">,</span> <span class="s2">&quot;iphone&quot;</span><span class="p">,</span> <span class="s2">&quot;ipad&quot;</span><span class="p">,</span> <span class="s2">&quot;ipod&quot;</span><span class="p">,</span> <span class="s2">&quot;blackberry&quot;</span><span class="p">,</span> <span class="s2">&quot;windows phone&quot;</span> <span class="p">];</span>
    <span class="k">return</span> <span class="o">!</span><span class="nx">shortlist</span><span class="p">.</span><span class="nx">every</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">system</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">!</span><span class="nx">agent</span><span class="p">.</span><span class="nx">contains</span> <span class="p">(</span> <span class="nx">system</span> <span class="p">);</span>
    <span class="p">});</span>
    
  <span class="p">})();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Supports CSS transitions?
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">hasTransitions</span> <span class="o">=</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="p">[</span> 
      <span class="s2">&quot;transition&quot;</span><span class="p">,</span> 
      <span class="s2">&quot;WebkitTransition&quot;</span><span class="p">,</span> 
      <span class="s2">&quot;MozTransition&quot;</span><span class="p">,</span> 
      <span class="s2">&quot;OTransition&quot;</span><span class="p">,</span> 
      <span class="s2">&quot;msTransition&quot;</span> 
      <span class="p">].</span><span class="nx">every</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">test</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">root</span><span class="p">.</span><span class="nx">style</span> <span class="p">[</span> <span class="nx">test</span> <span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">})();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Supports CSS 3D transform? (note https://bugzilla.mozilla.org/show_bug.cgi?id=677173)
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">has3D</span> <span class="o">=</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="p">[</span> 
      <span class="s2">&quot;perspective&quot;</span><span class="p">,</span> 
      <span class="s2">&quot;WebkitPerspective&quot;</span><span class="p">,</span> 
      <span class="s2">&quot;MozPerspective&quot;</span><span class="p">,</span> 
      <span class="s2">&quot;OPerspective&quot;</span><span class="p">,</span> 
      <span class="s2">&quot;msPerspective&quot;</span> 
      <span class="p">].</span><span class="nx">every</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">test</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">root</span><span class="p">.</span><span class="nx">style</span> <span class="p">[</span> <span class="nx">test</span> <span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">})();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Supports requestAnimationFrame somewhat natively?
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">hasAnimationFrame</span> <span class="o">=</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">win</span> <span class="o">=</span> <span class="nb">window</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> 
      <span class="nx">win</span><span class="p">.</span><span class="nx">requestAnimationFrame</span> <span class="o">||</span> 
      <span class="nx">win</span><span class="p">.</span><span class="nx">webkitRequestAnimationFrame</span> <span class="o">||</span> 
      <span class="nx">win</span><span class="p">.</span><span class="nx">mozRequestAnimationFrame</span> <span class="o">||</span> 
      <span class="nx">win</span><span class="p">.</span><span class="nx">msRequestAnimationFrame</span> <span class="o">||</span> 
      <span class="nx">win</span><span class="p">.</span><span class="nx">oRequestAnimationFrame</span>
    <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">})();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Supports MutationObserver feature?
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">hasMutations</span> <span class="o">=</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="p">[</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;WebKit&quot;</span><span class="p">,</span> <span class="s2">&quot;Moz&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;Ms&quot;</span> <span class="p">].</span><span class="nx">every</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">vendor</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">!</span><span class="nx">gui</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">isDefined</span> <span class="p">(</span> <span class="nb">window</span> <span class="p">[</span> <span class="nx">vendor</span> <span class="o">+</span> <span class="s2">&quot;MutationObserver&quot;</span> <span class="p">]);</span>
    <span class="p">});</span>
  <span class="p">})();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Time in milliseconds after window.onload before we can reliably measure 
document height. We could in theory discriminate between browsers here, 
but we won't. WebKit sucks more at this and Safari on iOS is dead to me.
@todo Now Firefox started to suck really bad. How can we fix this mess?
@todo Where to move this?
@type {number}</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">STABLETIME</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Browsers disagree on the primary scrolling element.
Is it document.body or document.documentElement? 
@see https://code.google.com/p/chromium/issues/detail?id=2891
@type {HTMLElement}</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">scrollRoot</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Scrollbar default span in pixels. 
Note that this is zero on mobiles.
@type {number}</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">scrollBarSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Supports position fixed?
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">hasPositionFixed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>@todo Move this somewhere else...
@param {gui.Broadcast} b</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">onbroadcast</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">b</span> <span class="p">)</span> <span class="p">{</span>   
    <span class="k">if</span> <span class="p">(</span> <span class="nx">b</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nb">document</span> <span class="o">===</span> <span class="nb">document</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>What is the scroll root?
Supports position fixed?</p></div></div><div class="code"><div class="wrapper">      <span class="kd">var</span> <span class="nx">win</span> <span class="o">=</span> <span class="nb">window</span><span class="p">,</span>
      <span class="nx">doc</span> <span class="o">=</span> <span class="nb">document</span><span class="p">,</span>
      <span class="nx">html</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span>
      <span class="nx">body</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span>
      <span class="nx">root</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>make sure window is scrollable</p></div></div><div class="code"><div class="wrapper">      <span class="kd">var</span> <span class="nx">temp</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span> <span class="p">(</span> 
        <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritCSS</span><span class="p">.</span><span class="nx">style</span> <span class="p">(</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span> <span class="p">(</span> <span class="s2">&quot;div&quot;</span> <span class="p">),</span> <span class="p">{</span>
          <span class="nx">position</span> <span class="o">:</span> <span class="s2">&quot;absolute&quot;</span><span class="p">,</span>
          <span class="nx">height</span> <span class="o">:</span> <span class="s2">&quot;10px&quot;</span><span class="p">,</span>
          <span class="nx">width</span><span class="o">:</span> <span class="s2">&quot;10px&quot;</span><span class="p">,</span>
          <span class="nx">top</span> <span class="o">:</span> <span class="s2">&quot;100%&quot;</span>
        <span class="p">})</span>
      <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>what element will get scrolled?</p></div></div><div class="code"><div class="wrapper">      <span class="nx">win</span><span class="p">.</span><span class="nx">scrollBy</span> <span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span> <span class="p">);</span>
      <span class="nx">root</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">?</span> <span class="nx">body</span> <span class="o">:</span> <span class="nx">html</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">scrollRoot</span> <span class="o">=</span> <span class="nx">root</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>supports position fixed?</p></div></div><div class="code"><div class="wrapper">      <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritCSS</span><span class="p">.</span><span class="nx">style</span> <span class="p">(</span> <span class="nx">temp</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">position</span> <span class="o">:</span> <span class="s2">&quot;fixed&quot;</span><span class="p">,</span>
        <span class="nx">top</span> <span class="o">:</span> <span class="s2">&quot;10px&quot;</span>
      <span class="p">});</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>restore scroll when finished</p></div></div><div class="code"><div class="wrapper">      <span class="kd">var</span> <span class="nx">has</span> <span class="o">=</span> <span class="nx">temp</span><span class="p">.</span><span class="nx">getBoundingClientRect</span> <span class="p">().</span><span class="nx">top</span> <span class="o">===</span> <span class="mi">10</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">hasPositionFixed</span> <span class="o">=</span> <span class="nx">has</span><span class="p">;</span>
      <span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span> <span class="p">(</span> <span class="nx">temp</span> <span class="p">);</span>
      <span class="nx">win</span><span class="p">.</span><span class="nx">scrollBy</span> <span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>compute scrollbar size</p></div></div><div class="code"><div class="wrapper">      <span class="kd">var</span> <span class="nx">inner</span> <span class="o">=</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritCSS</span><span class="p">.</span><span class="nx">style</span> <span class="p">(</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="p">(</span> <span class="s2">&quot;p&quot;</span> <span class="p">),</span> <span class="p">{</span>
        <span class="nx">width</span> <span class="o">:</span> <span class="s2">&quot;100%&quot;</span><span class="p">,</span>
        <span class="nx">height</span> <span class="o">:</span> <span class="s2">&quot;200px&quot;</span>
      <span class="p">});</span>
      <span class="kd">var</span> <span class="nx">outer</span> <span class="o">=</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritCSS</span><span class="p">.</span><span class="nx">style</span> <span class="p">(</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="p">(</span> <span class="s2">&quot;div&quot;</span> <span class="p">),</span> <span class="p">{</span>
        <span class="nx">position</span> <span class="o">:</span> <span class="s2">&quot;absolute&quot;</span><span class="p">,</span>
        <span class="nx">top</span> <span class="o">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
        <span class="nx">left</span> <span class="o">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
        <span class="nx">visibility</span> <span class="o">:</span> <span class="s2">&quot;hidden&quot;</span><span class="p">,</span>
        <span class="nx">width</span> <span class="o">:</span> <span class="s2">&quot;200px&quot;</span><span class="p">,</span>
        <span class="nx">height</span> <span class="o">:</span> <span class="s2">&quot;150px&quot;</span><span class="p">,</span>
        <span class="nx">overflow</span> <span class="o">:</span> <span class="s2">&quot;hidden&quot;</span>
      <span class="p">});</span>
      <span class="nx">outer</span><span class="p">.</span><span class="nx">appendChild</span> <span class="p">(</span> <span class="nx">inner</span> <span class="p">);</span>
      <span class="nx">html</span><span class="p">.</span><span class="nx">appendChild</span> <span class="p">(</span> <span class="nx">outer</span> <span class="p">);</span>
      <span class="kd">var</span> <span class="nx">w1</span> <span class="o">=</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">;</span>
      <span class="nx">outer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">overflow</span> <span class="o">=</span> <span class="s2">&quot;scroll&quot;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">w2</span> <span class="o">=</span> <span class="nx">inner</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">w1</span> <span class="o">===</span> <span class="nx">w2</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">w2</span> <span class="o">=</span> <span class="nx">outer</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">html</span><span class="p">.</span><span class="nx">removeChild</span> <span class="p">(</span> <span class="nx">outer</span> <span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">scrollBarSize</span> <span class="o">=</span> <span class="nx">w1</span> <span class="o">-</span> <span class="nx">w2</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Determine properties on startup.
@todo Compute all properties only when requested (via object.defineproperties).</p></div></div><div class="code"><div class="wrapper"><span class="p">(</span> <span class="kd">function</span> <span class="nx">initSpiritClient</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">gui</span><span class="p">.</span><span class="nx">Broadcast</span><span class="p">.</span><span class="nx">addGlobal</span> <span class="p">(</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">BROADCAST_DOMCONTENT</span><span class="p">,</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">Client</span> <span class="p">);</span>
<span class="p">})();</span></div></div></div></div></body></html>