<!DOCTYPE html><html lang="en"><head><title>plugins/life.plugin/gui.SpiritLifeTracker</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="plugins/life.plugin/gui.SpiritLifeTracker"><meta name="groc-project-path" content="src/plugins/life.plugin/gui.SpiritLifeTracker.js"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/plugins/life.plugin/gui.SpiritLifeTracker.js</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h1 id="guispiritlifetracker">gui.SpiritLifeTracker</h1>

<p>Tracking spirit life cycle events.
@extends {gui.SpiritTracker}</p></div></div><div class="code"><div class="wrapper"><span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLifeTracker</span> <span class="o">=</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritTracker</span><span class="p">.</span><span class="nx">extend</span> <span class="p">(</span> <span class="s2">&quot;gui.SpiritLifeTracker&quot;</span><span class="p">,</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Spirit is constructed? This is almost certainly true by 
the time you address the spirit.
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">constructed</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>@todo EXPERIMENT...
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">configured</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Is now or has ever been in page DOM?
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">entered</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Is curently located in page DOM? 
False whenever detached is true. 
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">attached</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Is currently not located in page DOM? Note that this is initially 
true until the spirit has been discovered and registered as attached.
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">detached</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Is ready? If so, it implies that all descendant spirits are also ready.
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">ready</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Not hidden.
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">visible</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Not shown.
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">invisible</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Spirit was in page DOM, but has now been removed (ie. it was 
detached and not re-attached in the same execution stack). 
This schedules the spirit for destruction.
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">exited</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Is destructed? If true, don't try anything funny.
@type {boolean}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">destructed</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>@todo move declaration to super!
@type {Map<String,Array<object>}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">_handlers</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Construction time.
@overloads {gui.SpiritTracker#construct}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">onconstruct</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">onconstruct</span> <span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_handlers</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span> <span class="p">(</span> <span class="kc">null</span> <span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Add one or more action handlers.
@param {object} arg
@param @optional {object} handler implements LifeListener interface, defaults to this.spirit
@returns {gui.Spirit}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">add</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">arg</span><span class="p">,</span> <span class="nx">handler</span> <span class="p">)</span> <span class="p">{</span>   
    <span class="nx">handler</span> <span class="o">=</span> <span class="nx">handler</span> <span class="o">?</span> <span class="nx">handler</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">spirit</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_breakdown</span> <span class="p">(</span> <span class="nx">arg</span> <span class="p">).</span><span class="nx">forEach</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">type</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addchecks</span> <span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="p">[</span> <span class="nx">handler</span> <span class="p">]))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_handlers</span> <span class="p">[</span> <span class="nx">type</span> <span class="p">])</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_handlers</span> <span class="p">[</span> <span class="nx">type</span> <span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_handlers</span> <span class="p">[</span> <span class="nx">type</span> <span class="p">].</span><span class="nx">push</span> <span class="p">(</span> <span class="nx">handler</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="k">this</span> <span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">spirit</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Remove one or more action handlers.
@param {object} arg
@param @optional {object} handler implements LifeListener interface, defaults to spirit
@returns {gui.Spirit}</p></div></div><div class="code"><div class="wrapper">  <span class="nx">remove</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">arg</span><span class="p">,</span> <span class="nx">handler</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">handler</span> <span class="o">=</span> <span class="nx">handler</span> <span class="o">?</span> <span class="nx">handler</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">spirit</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_breakdown</span> <span class="p">(</span> <span class="nx">arg</span> <span class="p">).</span><span class="nx">forEach</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">type</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">_removechecks</span> <span class="p">(</span> <span class="nx">type</span><span class="p">,</span> <span class="p">[</span> <span class="nx">handler</span> <span class="p">]))</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_handlers</span> <span class="p">[</span> <span class="nx">type</span> <span class="p">].</span><span class="nx">indexOf</span> <span class="p">(</span> <span class="nx">type</span> <span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_handlers</span> <span class="p">[</span> <span class="nx">type</span> <span class="p">].</span><span class="nx">remove</span> <span class="p">(</span> <span class="nx">index</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">_handlers</span> <span class="p">[</span> <span class="nx">type</span> <span class="p">].</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
          <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_handlers</span> <span class="p">[</span> <span class="nx">type</span> <span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="k">this</span> <span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">spirit</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Dispatch type.
@param {String} type</p></div></div><div class="code"><div class="wrapper">  <span class="nx">dispatch</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">type</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_handlers</span> <span class="p">[</span> <span class="nx">type</span> <span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">list</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">life</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">spirit</span><span class="p">,</span> <span class="nx">type</span> <span class="p">);</span>
      <span class="nx">list</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">handler</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">handler</span><span class="p">.</span><span class="nx">onlife</span> <span class="p">(</span> <span class="nx">life</span> <span class="p">);</span>
      <span class="p">});</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Cleanup handlers for life cycle events that only occurs once.</p></div></div><div class="code"><div class="wrapper">      <span class="k">switch</span> <span class="p">(</span> <span class="nx">type</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span><span class="p">.</span><span class="nx">ATTACH</span> <span class="o">:</span>
        <span class="k">case</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span><span class="p">.</span><span class="nx">DETACH</span> <span class="o">:</span>
        <span class="k">case</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span><span class="p">.</span><span class="nx">VISIBLE</span> <span class="o">:</span>
        <span class="k">case</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span><span class="p">.</span><span class="nx">INVISIBLE</span> <span class="o">:</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>may happen more than once</p></div></div><div class="code"><div class="wrapper">          <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span> <span class="o">:</span>
          <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_handlers</span> <span class="p">[</span> <span class="nx">type</span> <span class="p">];</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span> 
<span class="p">});</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Generate methods to update life cycle status:
1) Update booleans entered, attached, detached etc.
2) Dispatch life-event gui.SpiritLife.ATTACH etc.</p></div></div><div class="code"><div class="wrapper"><span class="p">(</span> <span class="kd">function</span> <span class="nx">generatecode</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">states</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">construct</span> <span class="o">:</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span><span class="p">.</span><span class="nx">CONSTRUCT</span><span class="p">,</span>
    <span class="nx">configure</span> <span class="o">:</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span><span class="p">.</span><span class="nx">CONFIGURE</span><span class="p">,</span>
    <span class="nx">enter</span> <span class="o">:</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span><span class="p">.</span><span class="nx">ENTER</span><span class="p">,</span>
    <span class="nx">attach</span> <span class="o">:</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span><span class="p">.</span><span class="nx">ATTACH</span><span class="p">,</span>
    <span class="nx">ready</span> <span class="o">:</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span><span class="p">.</span><span class="nx">READY</span><span class="p">,</span>
    <span class="nx">visible</span> <span class="o">:</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span><span class="p">.</span><span class="nx">VISIBLE</span><span class="p">,</span>
    <span class="nx">invisible</span> <span class="o">:</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span><span class="p">.</span><span class="nx">INVISIBLE</span><span class="p">,</span>
    <span class="nx">detach</span> <span class="o">:</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span><span class="p">.</span><span class="nx">DETACH</span><span class="p">,</span>
    <span class="nx">exit</span> <span class="o">:</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span><span class="p">.</span><span class="nx">EXIT</span><span class="p">,</span>
    <span class="nx">destruct</span> <span class="o">:</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLife</span><span class="p">.</span><span class="nx">DESTRUCT</span>
  <span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Prefix methods with "on", suffix booleans with "ed"</p></div></div><div class="code"><div class="wrapper">  <span class="nx">gui</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">each</span> <span class="p">(</span> <span class="nx">states</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLifeTracker</span><span class="p">.</span><span class="nx">addin</span> <span class="p">(</span> <span class="s2">&quot;go&quot;</span> <span class="o">+</span> <span class="nx">state</span> <span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">prop</span> <span class="o">=</span> <span class="nx">state</span><span class="p">;</span>
      <span class="k">switch</span> <span class="p">(</span> <span class="nx">state</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s2">&quot;ready&quot;</span> <span class="o">:</span>
        <span class="k">case</span> <span class="s2">&quot;visible&quot;</span> <span class="o">:</span>
        <span class="k">case</span> <span class="s2">&quot;invisible&quot;</span> <span class="o">:</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span> <span class="o">:</span>
          <span class="nx">prop</span> <span class="o">+=</span> <span class="s2">&quot;ed&quot;</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">this</span> <span class="p">[</span> <span class="nx">prop</span> <span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">switch</span> <span class="p">(</span> <span class="nx">state</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s2">&quot;enter&quot;</span> <span class="o">:</span>
        <span class="k">case</span> <span class="s2">&quot;attach&quot;</span> <span class="o">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">detached</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s2">&quot;detach&quot;</span> <span class="o">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">attached</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s2">&quot;visible&quot;</span> <span class="o">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">invisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s2">&quot;invisible&quot;</span> <span class="o">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">dispatch</span> <span class="p">(</span> <span class="nx">event</span> <span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">})();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Register plugin (not served in a module this plugin).</p></div></div><div class="code"><div class="wrapper"><span class="nx">gui</span><span class="p">.</span><span class="nx">Spirit</span><span class="p">.</span><span class="nx">plugin</span> <span class="p">(</span> <span class="s2">&quot;life&quot;</span><span class="p">,</span> <span class="nx">gui</span><span class="p">.</span><span class="nx">SpiritLifeTracker</span> <span class="p">);</span></div></div></div></div></body></html>